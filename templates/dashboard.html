<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnSync Dashboard</title>
    <link rel="stylesheet" href="../static/css/style-updated.css">
    <link rel="stylesheet" href="../static/css/style-dashboard.css">
</head>

<body>
    <main-container>
        <nav>
            <div class="logo" id="sidebar-logo" style="text-align: center;">LearnSync</div>
            <hr>
            <ul class="nav-list">
                <a class="nav-list-item-link active" id="link-home" onclick="toggleActive(event, 'container-home'); ">
                    <li class="nav-list-item">
                        <img src="../static/resources/images/dashboard/home-icon.png" alt="" srcset=""
                            class="nav-list-icon">
                        <span class="nav-list-text">Dashboard</span>
                    </li>
                </a>
                <a class="nav-list-item-link" id="link-leaderboards"
                    onclick="toggleActive(event, 'container-leaderboards')">
                    <li class="nav-list-item">
                        <img src="../static/resources/images/dashboard/leaderboard-icon.png" alt="" srcset=""
                            class="nav-list-icon">
                        <span class="nav-list-text">Leaderboards</span>
                    </li>
                </a>
                <a href="/flash_card/{{ user._id }} " id="link-flashcards" class="nav-list-item-link" target="_blank">
                    <li class="nav-list-item">
                        <img src="../static/resources/images/dashboard/flash-card-icon.png" alt="" srcset=""
                            class="nav-list-icon">
                        <span class="nav-list-text">Flashcards</span>
                    </li>
                </a>
                <a class="nav-list-item-link" id="link-profile" onclick="toggleActive(event, 'container-profile')">
                    <li class="nav-list-item">
                        <img src="../static/resources/images/dashboard/profile-icon.png" alt="" srcset=""
                            class="nav-list-icon">
                        <span class="nav-list-text">Profile</span>
                    </li>
                </a>
                <a class="nav-list-item-link" id="link-preferences"
                    onclick="toggleActive(event, 'container-preferences')">
                    <li class="nav-list-item">
                        <img src="../static/resources/images/dashboard/settings-icon.png" alt="" srcset=""
                            class="nav-list-icon">
                        <span class="nav-list-text">Preferences</span>
                    </li>
                </a>
                <a class="nav-list-item-link " id="more-info-container" onclick="toggleActive(event, 'container-home')">
                    <li class="nav-list-item" id="nav-list-more-menu">
                        <img src="../static/resources/images/dashboard/more-icon.png" alt="" srcset=""
                            class="nav-list-icon">
                        <span class="nav-list-text">More</span>
                        <!-- Floating Menu -->
                    </li>
                </a>
            </ul>
            <button id="side-bar-collapse-btn">
                <span class="material-symbols-outlined" style="font-size: 32px;" id="side-bar-text">
                    chevron_left
                </span>
            </button>
        </nav>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Get the button element
                const sideBarCollapseBtn = document.getElementById('side-bar-collapse-btn');

                // Initialize variable to track the state
                let isExpanded = getCookie('sidebarExpanded') === 'true';

                // Set initial state based on the cookie value
                setSidebarState(isExpanded);

                // Add click event listener to the button
                sideBarCollapseBtn.addEventListener('click', function () {
                    // Toggle the state
                    isExpanded = !isExpanded;
                    // Set the state in the cookie
                    setCookie('sidebarExpanded', isExpanded, 365); // Store the state for 365 days
                    // Update the sidebar state
                    setSidebarState(isExpanded);
                });

                // Function to set the sidebar state based on the expanded value
                function setSidebarState(expanded) {
                    // Get all elements with class 'nav-list-text'
                    const navListItems = document.querySelectorAll('.nav-list-item');
                    // Toggle visibility of each nav-list-item
                    navListItems.forEach(function (element) {
                        // Toggle display style between 'flex' and 'none'
                        element.style.display = 'flex';
                        // Set flex direction to 'column' if expanded, 'row' otherwise
                        element.style.flexDirection = expanded ? 'row' : 'column';
                        // Set font size to 'small' if expanded, 'large' otherwise
                        element.querySelector('.nav-list-text').style.fontSize = expanded ? '24px' : '14px';
                        // Set padding
                        element.style.padding = expanded ? '15px' : '5px';
                    });
                    // Toggle text content of span with id 'side-bar-text'
                    const sideBarText = document.getElementById('side-bar-text');
                    sideBarText.textContent = expanded ? 'chevron_left' : 'chevron_right';
                    // Change text content of sidebar logo based on current state
                    const sideBarLogo = document.getElementById('sidebar-logo');
                    sideBarLogo.textContent = expanded ? 'LearnSync' : 'LS';
                }

                // Function to set a cookie
                function setCookie(name, value, days) {
                    const expires = new Date();
                    expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
                    document.cookie = name + '=' + value + ';expires=' + expires.toUTCString();
                }

                // Function to get a cookie
                function getCookie(name) {
                    const keyValue = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
                    return keyValue ? keyValue[2] : null;
                }
            });

        </script>
        <main-content-wrapper>

            <main-content-container>
                <content-container>
                    <div class="container-home" id="container-home" data-aos="fade-up" data-aos-duration="1000">
                        <div class="title-dashboard">Dashboard</div>
                        <div class="container-default home-pomodoro-timer">
                            <a id="expand-timer" onclick="expandTimer()">
                                <span class="material-symbols-outlined " style="font-size:32px;">
                                    expand_content
                                </span>
                            </a>
                            <a id="collapse-timer" onclick="collapseTimer()">
                                <span class="material-symbols-outlined" style="font-size:32px;">
                                    collapse_content
                                </span>
                            </a>

                            <!-- <div class="heading">Pomodoro Timer</div> -->
                            <div class="container-pomodoro-timer">
                                <div id="time">
                                    <div id="time-min">25</div>
                                    <div id="time-colon">:</div>
                                    <div id="time-sec">00</div>
                                </div>
                                <div id="pomo-btns">
                                    <a id="start" class="link-primary-btn">Start</a>
                                    <a id="stop" class="link-secondary-btn">Stop</a>
                                    <a id="reset" class="link-tertiary-btn">Reset</a>
                                </div>
                            </div>
                            <form class="container-pomodoro-selector">
                                <div class="pomodoro-selector">
                                    <input type="radio" name="time_opt" data-option="0" value="1" checked>
                                    Timer N-N
                                </div>
                                <div class="pomodoro-selector">
                                    <input type="radio" name="time_opt" data-option="1" value="2">
                                    Time N-N
                                </div>
                                <div class="pomodoro-selector">
                                    <input type="radio" name="time_opt" data-option="2" value="3">
                                    Time N-N
                                </div>
                            </form>
                            <audio id="timer-sound">
                                <source src="../static/resources/sounds/pomodoro_timer/sound_1.mp3" type="audio/mp3">
                                Your browser does not support the audio element.
                            </audio>
                            <script>
                                function expandTimer() {
                                    document.getElementById("expand-timer").style.display = "none";
                                    document.getElementById("collapse-timer").style.display = "flex";
                                    var timerContainer = document.querySelector('.home-pomodoro-timer');
                                    // var timeContainer = document.querySelector('#time');
                                    // var minContainer = document.querySelector('#time-min');
                                    // var secContainer = document.querySelector('#time-sec');
                                    // minContainer.classList.add("timer-full-time");
                                    timerContainer.classList.add('home-pomodoro-timer-full');
                                    timerContainer.classList.remove('container-default');


                                }
                                function collapseTimer() {
                                    document.getElementById("expand-timer").style.display = "flex";
                                    document.getElementById("collapse-timer").style.display = "none";
                                    var timerContainer = document.querySelector('.home-pomodoro-timer');
                                    timerContainer.classList.remove('home-pomodoro-timer-full');
                                    timerContainer.classList.add('container-default');
                                }
                            </script>
                        </div>
                    </div>
                    <div class="container-preferences" id="container-preferences">
                        <div class="title-dashboard">User Preferences</div>
                        <span class="secondary-heading">Your Daily Tasks</span>
                        <div class="user-daily-tasks ">
                            <div class="user-daily-tasks-container container-default">
                                <div class="user-daily-tasks-set-con">

                                    <span class="secondary-heading">Set Your Tasks Here </span>

                                    <div class="user-daily-tasks-set">
                                        <!-- <div class="user-task-item smart-input-gen-container">
                                            <div class="asthetic-bar"></div>
                                            <input type="text" class="user-task-inp" placeholder="Add a task...">
                                            <button class="set-tsk-lvl tsk-lvl-1">
                                                <span class="material-symbols-outlined" style="font-size: 24px;">
                                                    stars
                                                </span>
                                            </button>
                                            <div class="tsk-actions-con">
                                                <button class="save-user-tsk ui-button-2" disabled>
                                                    <span class="material-symbols-outlined" style="font-size: 24px;">
                                                        done
                                                    </span>
                                                </button>
                                                <button class="del-user-tsk ui-button-2">
                                                    <span class="material-symbols-outlined" style="font-size: 24px;">
                                                        remove
                                                    </span>
                                                </button>
                                            </div>
                                        </div> -->

                                        <!-- <span class="less-imp-text" style="margin: 0 auto;">No Tasks Found. <a href="#" id="create-a-tsk">Create a Task.</a></span> -->
                                    </div>
                                    <div class="tasks-set-act-btn">
                                        <button class="ui-button-3" id="add-user-daily-task">
                                            <span class="material-symbols-outlined" style="font-size: 24px;">
                                                add_task
                                            </span> &nbsp;Add Task
                                        </button>

                                    </div>
                                    <!-- Script to add daily task -->


                                </div>
                                <!-- <h1>Add Task to Calendar</h1>
                                <form action="/update-daily-task" method="post">
                                    <label for="task">Task:</label><br>
                                    <input type="text" id="task" name="task" required><br><br>
                                    <label for="start_date">Start Date:</label><br>
                                    <input type="date" id="start_date" name="start_date" required><br>
                                    <label for="start_time">Start Time:</label><br>
                                    <input type="time" id="start_time" name="start_time" required><br><br>
                                    <label for="duration">Task Duration:</label><br>
                                    <select id="duration" name="duration" required>
                                        <option value="0.5">30 minutes</option>
                                        <option value="1">1 hour</option>
                                        <option value="1.5">1.5 hours</option>
                                    </select><br><br>
                                    <label for="calendar_email">Calendar Email:</label><br>
                                    <input type="email" id="calendar_email" name="calendar_email" required><br><br>
                                    <input type="submit" value="Add Task">
                                </form> -->
                            </div>
                        </div>
                        <div class="user-daily-tasks-info">
                            <div class="secondary-heading">Your Tasks Overview</div>
                            <div class="user-daily-tasks-stats-con">
                                <div class="user-daily-tasks-total container-default">

                                </div>
                                <div class="user-daily-tasks-streak container-default">

                                </div>
                                <div class="user-daily-tasks-rank container-default">

                                </div>
                                <div class="user-daily-tasks-experience container-default">

                                </div>
                            </div>
                        </div>
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                // Add click event listener to the document and delegate it to the button
                                document.addEventListener("click", function (event) {
                                    var button = event.target.closest(".set-tsk-lvl");
                                    if (button) {
                                        var input = button.closest(".user-task-item").querySelector(".user-task-inp");

                                        // Get the current class of the button
                                        var currentClass = button.className;
                                        // console.log("Current class: " + currentClass);

                                        // Extract the current level from the class
                                        var currentLevelMatch = currentClass.match(/tsk-lvl-(\d+)/);
                                        if (currentLevelMatch && currentLevelMatch.length > 1) {
                                            var currentLevel = parseInt(currentLevelMatch[1]);
                                            // console.log("Current level: " + currentLevel);

                                            // Update the class to the next level or cycle back to 1 if already at 3
                                            var nextLevel = currentLevel % 3 + 1;
                                            // console.log("Next level: " + nextLevel);
                                            button.classList.remove("tsk-lvl-" + currentLevel);
                                            button.classList.add("tsk-lvl-" + nextLevel);

                                            // Update the dataset attribute of the input element
                                            input.dataset.level = nextLevel;
                                            // console.log("Input dataset level: " + input.dataset.level);
                                        } else {
                                            // console.error("Failed to extract current level from class.");
                                        }
                                    }
                                });
                            });
                        </script>
                        <script>
                            var colors = ['#13d1ff', '#19a5ff', '#fee719', '#fe4f19', '#f00c18'];

                            var container = document.querySelector('.user-daily-tasks-set');
                            var addUsrTskButton = document.getElementById('add-user-daily-task');

                            function createTaskItem() {
                                // Create task item container
                                var taskItemContainer = document.createElement('div');
                                taskItemContainer.classList.add('user-task-item', 'smart-input-gen-container');

                                var randomColor = colors[Math.floor(Math.random() * colors.length)];
                                // Create aesthetic bar
                                var aestheticBar = document.createElement('div');
                                aestheticBar.classList.add('asthetic-bar');
                                aestheticBar.style.backgroundColor = randomColor;

                                // Create input field
                                var inputField = document.createElement('input');
                                inputField.setAttribute('type', 'text');
                                inputField.classList.add('user-task-inp');
                                inputField.setAttribute('placeholder', 'Add a task...');
                                inputField.dataset.level = 1;

                                // Create set level button
                                var setLevelButton = document.createElement('button');
                                setLevelButton.classList.add('set-tsk-lvl', 'tsk-lvl-1');
                                var setLevelIcon = document.createElement('span');
                                setLevelIcon.classList.add('material-symbols-outlined');
                                setLevelIcon.style.fontSize = '24px';
                                setLevelIcon.textContent = 'stars';
                                setLevelButton.appendChild(setLevelIcon);

                                setLevelButton.addEventListener('click', function () {
                                    saveButton.disabled = false;
                                });

                                // Create button container
                                var buttonContainer = document.createElement('div');
                                buttonContainer.classList.add('tsk-actions-con');

                                // Create save button
                                var saveButton = document.createElement('button');
                                saveButton.classList.add('save-user-tsk', 'ui-button-2');
                                // saveButton.setAttribute('disabled', '');
                                var saveButtonIcon = document.createElement('span');
                                saveButtonIcon.classList.add('material-symbols-outlined');
                                saveButtonIcon.style.fontSize = '24px';
                                saveButtonIcon.textContent = 'done';
                                saveButton.appendChild(saveButtonIcon);
                                saveButton.disabled = true;

                                saveButton.addEventListener('click', async function () {
                                    var inputValue = inputField.value;
                                    var inputLevel = inputField.dataset.level;
                                    saveButton.disabled = true;
                                    // console.log(inputValue, inputLevel);
                                    await generateUserDailyTasksToShow();
                                    createUserDailyTask(inputValue, inputLevel)
                                        .then(taskId => {
                                            taskItemContainer.dataset.task_Id = taskId;

                                        })
                                        .catch(error => {
                                            console.error('Error creating daily task:', error);
                                        });
                                });

                                // Create delete button
                                var deleteButton = document.createElement('button');
                                deleteButton.classList.add('del-user-tsk', 'ui-button-2');
                                var deleteButtonIcon = document.createElement('span');
                                deleteButtonIcon.classList.add('material-symbols-outlined');
                                deleteButtonIcon.style.fontSize = '24px';
                                deleteButtonIcon.textContent = 'remove';
                                deleteButton.appendChild(deleteButtonIcon);

                                deleteButton.addEventListener('click', function () {
                                    taskItemContainer.remove();
                                });

                                inputField.addEventListener('input', function () {
                                    console.log(inputField.value);
                                    if (inputField.value.trim() === "") {
                                        saveButton.disabled = true;
                                        // console.log("Save button disabled");
                                    } else {
                                        saveButton.disabled = false;
                                        // console.log("Save button enabled");
                                    }
                                });

                                // Append elements to button container
                                buttonContainer.appendChild(saveButton);
                                buttonContainer.appendChild(deleteButton);

                                // Append elements to task item container
                                taskItemContainer.appendChild(aestheticBar);
                                taskItemContainer.appendChild(inputField);
                                taskItemContainer.appendChild(setLevelButton);
                                taskItemContainer.appendChild(buttonContainer);

                                // Append task item container to the daily tasks container
                                container.appendChild(taskItemContainer);
                            }

                            function createUserDailyTask(taskName, taskPriority) {
                                const data = {
                                    value: taskName,
                                    level: taskPriority
                                };

                                return fetch('/create-user-daily-task', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Access the returned task ID from the response
                                        const taskId = data.id;
                                        console.log('Task ID:', taskId);
                                        return taskId;
                                        // Continue with further processing if needed
                                    })

                            }

                            addUsrTskButton.addEventListener('click', function () {
                                // Call the createTaskItem function when the button is clicked
                                createTaskItem();
                            });

                            async function fetchUserDailyTasks() {
                                try {
                                    const response = await fetch('/fetch-user-daily-tasks', {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        }
                                    });
                                    if (!response.ok) {
                                        throw new Error('Failed to fetch user daily tasks');
                                    }
                                    const tasks = await response.json();
                                    // Handle the fetched tasks
                                    return tasks;
                                    // Process tasks and update UI as needed
                                } catch (error) {
                                    console.error('Error fetching user daily tasks:', error);
                                    // Handle errors as needed
                                }
                            }

                            async function generateUserDailyTasks() {
                                try {
                                    var colors = ['#13d1ff', '#19a5ff', '#fee719', '#fe4f19', '#f00c18'];

                                    var container = document.querySelector('.user-daily-tasks-set');

                                    // Make a fetch request to the Flask application endpoint
                                    const response = await fetchUserDailyTasks();
                                    if (response.length > 0) {
                                        response.forEach(task => {
                                            var taskItemContainer = document.createElement('div');
                                            taskItemContainer.classList.add('user-task-item', 'smart-input-gen-container');

                                            var randomColor = colors[Math.floor(Math.random() * colors.length)];
                                            // Create aesthetic bar
                                            var aestheticBar = document.createElement('div');
                                            aestheticBar.classList.add('asthetic-bar');
                                            aestheticBar.style.backgroundColor = randomColor;

                                            // Create input field
                                            var inputField = document.createElement('input');
                                            inputField.setAttribute('type', 'text');
                                            inputField.classList.add('user-task-inp');
                                            inputField.setAttribute('placeholder', 'Add a task...');
                                            inputField.dataset.level = task.taskPriority;
                                            inputField.value = task.taskName;

                                            // Create set level button
                                            var setLevelButton = document.createElement('button');
                                            setLevelButton.classList.add('set-tsk-lvl', `tsk-lvl-${task.taskPriority}`);
                                            var setLevelIcon = document.createElement('span');
                                            setLevelIcon.classList.add('material-symbols-outlined');
                                            setLevelIcon.style.fontSize = '24px';
                                            setLevelIcon.textContent = 'stars';
                                            setLevelButton.appendChild(setLevelIcon);

                                            setLevelButton.addEventListener('click', function () {
                                                saveButton.disabled = false;
                                            });

                                            // Create button container
                                            var buttonContainer = document.createElement('div');
                                            buttonContainer.classList.add('tsk-actions-con');

                                            // Create save button
                                            var saveButton = document.createElement('button');
                                            saveButton.classList.add('save-user-tsk', 'ui-button-2');
                                            // saveButton.setAttribute('disabled', '');
                                            var saveButtonIcon = document.createElement('span');
                                            saveButtonIcon.classList.add('material-symbols-outlined');
                                            saveButtonIcon.style.fontSize = '24px';
                                            saveButtonIcon.textContent = 'done';
                                            saveButton.appendChild(saveButtonIcon);
                                            saveButton.disabled = true;

                                            saveButton.addEventListener('click', async function () {
                                                var inputValue = inputField.value;
                                                var inputLevel = inputField.dataset.level;
                                                saveButton.disabled = true;
                                                console.log(inputValue, inputLevel);
                                                await updateUserDailyTask(inputValue, inputLevel, task.taskId);
                                                await generateUserDailyTasksToShow();

                                            });

                                            // Create delete button
                                            var deleteButton = document.createElement('button');
                                            deleteButton.classList.add('del-user-tsk', 'ui-button-2');
                                            var deleteButtonIcon = document.createElement('span');
                                            deleteButtonIcon.classList.add('material-symbols-outlined');
                                            deleteButtonIcon.style.fontSize = '24px';
                                            deleteButtonIcon.textContent = 'remove';
                                            deleteButton.appendChild(deleteButtonIcon);

                                            deleteButton.addEventListener('click', async function () {
                                                await deleteUserDailyTask(task.taskId);
                                                taskItemContainer.remove();
                                            });

                                            inputField.addEventListener('input', function () {
                                                console.log(inputField.value);
                                                if (inputField.value.trim() === "") {
                                                    saveButton.disabled = true;
                                                    // console.log("Save button disabled");
                                                } else {
                                                    saveButton.disabled = false;
                                                    // console.log("Save button enabled");
                                                }
                                            });

                                            // Append elements to button container
                                            buttonContainer.appendChild(saveButton);
                                            buttonContainer.appendChild(deleteButton);

                                            // Append elements to task item container
                                            taskItemContainer.appendChild(aestheticBar);
                                            taskItemContainer.appendChild(inputField);
                                            taskItemContainer.appendChild(setLevelButton);
                                            taskItemContainer.appendChild(buttonContainer);

                                            // Append task item container to the daily tasks container
                                            container.appendChild(taskItemContainer); // Assuming createTaskItem function exists and creates a task item
                                        });
                                        var spanElement = document.createElement('span');
                                        spanElement.classList.add('less-imp-text');
                                        spanElement.style.margin = '0 auto';
                                        spanElement.textContent = 'End-Of-List';
                                        container.appendChild(spanElement);

                                    } else {
                                        var spanElement = document.createElement('span');
                                        spanElement.classList.add('less-imp-text');
                                        spanElement.style.margin = '0 auto';

                                        // Create the text node
                                        var textNode = document.createTextNode('No Tasks Found. ');

                                        // Create the anchor element
                                        var anchorElement = document.createElement('a');
                                        anchorElement.setAttribute('href', '#');
                                        anchorElement.setAttribute('id', 'create-a-tsk');
                                        anchorElement.textContent = 'Create a Task.';
                                        anchorElement.onclick = function () {
                                            createTaskItem();
                                            spanElement.style.display = 'none';
                                        };

                                        spanElement.appendChild(textNode);
                                        spanElement.appendChild(anchorElement);

                                        container.appendChild(spanElement);
                                    }
                                } catch (error) {
                                    console.error('Error fetching user daily tasks:', error);
                                }
                            }

                            function updateUserDailyTask(taskName, taskPriority, taskId) {
                                const data = {
                                    value: taskName,
                                    level: taskPriority,
                                    id: taskId
                                };

                                return fetch('/update-user-daily-task', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Access the returned message from the response
                                        const message = data.message;
                                        console.log('Received Message:', message);
                                        return message; // Return the received message
                                        // Continue with further processing if needed
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        // Handle errors as needed
                                    });
                            }

                            function deleteUserDailyTask(taskId) {
                                const data = { id: taskId };

                                return fetch('/delete-user-daily-task', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Access the received message from the response
                                        const message = data.message;
                                        console.log('Received Message:', message);
                                        return message; // Return the received message
                                        // Continue with further processing if needed
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        // Handle errors as needed
                                    });
                            }
                        </script>
                        <!-- <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                var colors = ['#13d1ff', '#19a5ff', '#fee719', '#fe4f19', '#f00c18'];

                                var container = document.querySelector('.user-daily-tasks-set');


                                // Create task item container
                                var taskItemContainer = document.createElement('div');
                                taskItemContainer.classList.add('user-task-item', 'smart-input-gen-container');

                                // Randomly select a color from the colors array
                                var randomColor = colors[Math.floor(Math.random() * colors.length)];

                                // Create aesthetic bar
                                var aestheticBar = document.createElement('div');
                                aestheticBar.classList.add('asthetic-bar');
                                aestheticBar.style.backgroundColor = randomColor;

                                // Create input field
                                var inputField = document.createElement('input');
                                inputField.setAttribute('type', 'text');
                                inputField.classList.add('user-task-inp');
                                inputField.setAttribute('placeholder', 'Add a task...');
                                inputField.dataset.level = 1;

                                // Create button
                                var button = document.createElement('button');
                                button.classList.add('set-tsk-lvl', 'tsk-lvl-1');
                                button.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px;">stars</span>';

                                // Append elements to task item container
                                taskItemContainer.appendChild(aestheticBar);
                                taskItemContainer.appendChild(inputField);
                                taskItemContainer.appendChild(button);

                                // Append task item container to the daily tasks container
                                container.appendChild(taskItemContainer);

                            });
                        </script> -->
                        <div id="pomo-seq-info">
                            <div class="secondary-heading">Pomodoro Timer Sequences</div>
                            <a href="" class="info-btn" id="pomo-seq-info-link">
                                <span class="material-symbols-outlined" style="font-size: 14px;">
                                    help
                                </span>
                                <div id="pomo-seq-info-text" class="tool-tip">
                                    1. Keep input field empty to remove sequence.<br>2. Odd positions represent work
                                    time, even positions are break time, separated by commas.
                                </div>
                            </a>
                        </div>
                        <div class="user-pomodoro-sequences container-default">
                            <div class="user-pomodoro-suggestions">
                                <div class="user-pomo-suggestion-header">
                                    <span class="secondary-heading">Your Sequences</span>
                                    <div class="pomo-form-actions">

                                        <a class="ui-button-2" id="addSequence">
                                            <span class="material-symbols-outlined" style="font-size: 24px;">
                                                add_circle
                                            </span></a>
                                        <a class="ui-button-2" id="update-sequence-btn">
                                            <span class="material-symbols-outlined" style="font-size: 24px;">
                                                save
                                            </span></a>
                                    </div>
                                </div>
                                <form action="" id="user-pomodoro-form">
                                    <div class="user-pomodoro-form-sequence smart-input-gen-container ">
                                    </div>
                                </form>
                            </div>
                            <div class="our-pomodoro-suggestions">
                                <div class="secondary-heading">LearnSync's Suggestions</div>
                                <div class="suggestion-con">
                                    <button class="ui-button-3" id="ai-btn" style="width: 200px; padding: 10px;">
                                        <span class="material-symbols-outlined" style="font-size: 28px;">
                                            experiment
                                        </span>&nbsp;
                                        <span class="ai-text" style="white-space: nowrap;">Suggest a Sequence</span>
                                    </button>

                                    <div id="pomodoro-suggestion">
                                        <span id="suggested_seq">
                                            1, 2, 3, 4, 5, 6
                                        </span>
                                        <button class="ui-button-3" id="add-suggestion">
                                            <span class="material-symbols-outlined" style="font-size: 28px;">
                                                alarm_on
                                            </span>&nbsp;Add</button>
                                    </div>
                                </div>
                                <span class="less-imp-text"
                                    style="align-items: center; display: flex; flex-direction: row; text-align: center;">LearnSync
                                    employs AI to suggest study sequences based on >users usage hours and ratings.
                                    Pomodoro suggestion feature is beta. Results may vary.</span>
                                <script>
                                    var arr = [];
                                    function addAISequence(text) {
                                        const container = document.querySelector('.user-pomodoro-form-sequence');
                                        const sequenceInput = document.createElement('input');
                                        sequenceInput.type = 'text';
                                        sequenceInput.name = `sequence[]`; // Set unique name for each input field
                                        sequenceInput.value = text;
                                        container.appendChild(sequenceInput);
                                        const updateSequenceBtn = document.getElementById('update-sequence-btn');

                                        // Create a new click event
                                        const clickEvent = new Event('click');

                                        // Dispatch the click event on the update-sequence-btn element
                                        updateSequenceBtn.dispatchEvent(clickEvent);
                                    }

                                    // Add a click event listener to the button
                                    document.getElementById('add-suggestion').addEventListener('click', function (event) {
                                        // This function will be called when the button is clicked

                                        var string = arr.join(', ');
                                        // console.log(string);
                                        addAISequence(string);
                                        // You can add your desired functionality here
                                    });

                                    document.addEventListener('DOMContentLoaded', function () {
                                        document.getElementById('ai-btn').addEventListener('click', async function () {
                                            applyStyles();
                                            var data = await sendFetchRequest();
                                            const conSpan = document.querySelector("#suggested_seq");
                                            const mainCon = document.querySelector("#pomodoro-suggestion");
                                            mainCon.style.opacity = '1';
                                            conSpan.innerHTML = data.suggested_sequence;
                                            arr = data.suggested_sequence;
                                            revertStyles();

                                        });
                                    });

                                    function sendFetchRequest() {
                                        return new Promise((resolve, reject) => {
                                            fetch('/get-ai-suggestion', {
                                                method: 'GET',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                }
                                            })
                                                .then(response => {
                                                    if (!response.ok) {
                                                        throw new Error('Network response was not ok');
                                                    }
                                                    return response.json();
                                                })
                                                .then(data => {
                                                    resolve(data); // Resolve the promise with the received data
                                                })
                                                .catch(error => {
                                                    console.error('There was a problem with the fetch operation:', error);
                                                    reject(error); // Reject the promise with the error
                                                });
                                        });
                                    }

                                    function applyStyles() {
                                        var button = document.getElementById('ai-btn');
                                        var span = button.querySelector('span.material-symbols-outlined');
                                        var textSpan = button.querySelector('span.ai-text');

                                        button.classList.add('ai-button');
                                        span.textContent = "linked_services";
                                        textSpan.textContent = "Generating";
                                    }

                                    function revertStyles() {
                                        var button = document.getElementById('ai-btn');
                                        var span = button.querySelector('span.material-symbols-outlined');
                                        var textSpan = button.querySelector('span.ai-text');

                                        button.classList.remove('ai-button');
                                        span.textContent = 'experiment';
                                        textSpan.textContent = "Suggest a Sequence";
                                    }

                                    function changeBackground() {
                                        var button = document.getElementById('ai-btn');
                                        var span = button.querySelector('span.material-symbols-outlined');
                                        var orgSpan = span.textContent;
                                        var textSpan = button.querySelector('span.ai-text');
                                        var orgTxt = textSpan.textContent;


                                        button.classList.add('ai-button');
                                        span.textContent = "linked_services";
                                        textSpan.textContent = "Generating";

                                        setTimeout(function () {
                                            button.classList.remove('ai-button');
                                            span.textContent = orgSpan;
                                            textSpan.textContent = orgTxt;
                                        }, 10000);
                                    }
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="container-profile" id="container-profile">
                        <div class="title-dashboard">Profile</div>
                        <div class="container-profile-info">
                            <div class="info-general">
                                <span id="profile-name" class="secondary-heading" style="line-height: 0;"></span>
                                <span id="profile-email" class="tertiary-heading" style="color: var(--wolf);"></span>
                                <span id="profile-join-date" class="less-imp-text"></span>
                            </div>
                            <div class="info-social"></div>
                            <hr>
                        </div>
                        <div class="container-profile-statistics">
                            <span class="secondary-heading">Statistics</span>
                            <div class="profile-stats-container">
                                <div class="profile-stats container-default">
                                    <img src="../static/resources/images/dashboard/streak-icon.png" alt=""
                                        class="profile-stats-icon">
                                    <div class="profile-stats-data">
                                        <span class="stats-data-main">32</span>
                                        <span class="stats-data-label" id="u-streak">Days Streak</span>
                                    </div>
                                </div>
                                <div class="profile-stats container-default">
                                    <img src="../static/resources/images/dashboard/gems-icon.png" alt=""
                                        class="profile-stats-icon">
                                    <div class="profile-stats-data">
                                        <span class="stats-data-main">32</span>
                                        <span class="stats-data-label" id="u-xp">Total XP</span>
                                    </div>
                                </div>
                                <div class="profile-stats container-default">
                                    <img src="../static/resources/images/dashboard/heart-icon.png" alt=""
                                        class="profile-stats-icon">
                                    <div class="profile-stats-data">
                                        <span class="stats-data-main">32</span>
                                        <span class="stats-data-label" id="u-hearts">Hearts Collected</span>
                                    </div>
                                </div>
                                <div class="profile-stats container-default">
                                    <img src="../static/resources/images/dashboard/leaderboard-icon.png" alt=""
                                        class="profile-stats-icon">
                                    <div class="profile-stats-data">
                                        <span class="stats-data-main">32</span>
                                        <span class="stats-data-label" id="u-top10">Top 10 finishes</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-friends">
                            <div class="secondary-heading">Friends</div>
                            <div class="friend-display-container container-default">
                                <div class="friend-list">
                                    <div class="friend-search smart-input-container">
                                        <span class="material-symbols-outlined" style="font-size: 24px;">
                                            search
                                        </span>
                                        <input type="text" name="" id="friend-search-input" placeholder="Search Friend">
                                    </div>
                                    <script>
                                        const friendSearchInput = document.getElementById('friend-search-input');
                                        friendSearchInput.addEventListener('keyup', function (event) {
                                            // Call the function to generate user group list'
                                            const searchText = friendSearchInput.value;
                                            generateUserFriendsList(searchText);
                                        });
                                    </script>
                                    <div class="friend-list-container">

                                        <!-- <a class="frnd-lst-item" href="#">
                                            <div class="frnd-logo">
                                                J
                                            </div>
                                            <div class="frnd-name">
                                                <span class="grp-name">Jacob's</span>
                                            </div>
                                        </a>
                                        <a class="frnd-lst-item" href="#">
                                            <div class="frnd-logo">
                                                J
                                            </div>
                                            <div class="frnd-name">
                                                <span class="grp-name">Jacob</span>
                                            </div>
                                        </a>
                                        <a class="frnd-lst-item" href="#">
                                            <div class="frnd-logo">
                                                J
                                            </div>
                                            <div class="frnd-name">
                                                <span class="grp-name">Jacob'</span>
                                            </div>
                                        </a> -->

                                    </div>
                                </div>
                                <div class="friend-details">
                                    <div class="empty-state" id="empty-state-friend">
                                        Select a friend to view details
                                    </div>

                                    <div class="selected-friend-info">
                                        <div class="friend-header">
                                            <div class="friend-title">
                                                <div class="frnd-title " style="display: flex; flex-direction: row;
                                                align-items: center; gap: 10px;">
                                                    <span class="frnd-name" id="frnd-name"
                                                        style="text-align: left;">Jacob</span>
                                                </div>
                                            </div>
                                            <div class="friend-information">
                                                <span class="extra-info" id="frnd-email"></span>
                                                <span class="less-imp-text" id="frnd-common"
                                                    style="font-weight: 800;"></span>
                                            </div>
                                            <!-- <button class="group-info ui-button" id="group-info-more">
                                                    <span class="material-symbols-outlined" style="font-size: 24px;">
                                                    more_horiz
                                                </span>
                                            </button> -->

                                        </div>
                                        <div class="friend-main">
                                            <div class="temp-con">
                                                <span class="less-imp-text">Streaks-Overview</span>
                                                <div class="longest-streak">
                                                    <img src="../static/resources/images/dashboard/streak-icon.png"
                                                        alt="" class="friend-stats-icon">
                                                    <div class="report-card-data">
                                                        <span class="report-val" id="longest-streak">32</span>
                                                        <span class="report-desc" id="longest-streak-desc">Longest
                                                            Streak
                                                            between you and
                                                            {friend}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="temp-con">
                                                <span class="less-imp-text">Friend-Stats</span>
                                                <div class="friend-report-card ">
                                                    <div class="report-card-item">
                                                        <img src="../static/resources/images/dashboard/streak-icon.png"
                                                            alt="" class="friend-stats-icon">
                                                        <div class="report-card-data">
                                                            <span class="report-val" id="report-streak">32</span>
                                                            <span class="report-desc">Longest Streak</span>
                                                        </div>
                                                    </div>
                                                    <div class="report-card-item">
                                                        <img src="../static/resources/images/dashboard/gems-icon.png"
                                                            alt="" class="friend-stats-icon">
                                                        <div class="report-card-data">
                                                            <span class="report-val" id="report-gems">32</span>
                                                            <span class="report-desc">Total XP</span>
                                                        </div>
                                                    </div>
                                                    <div class="report-card-item">
                                                        <img src="../static/resources/images/dashboard/heart-icon.png"
                                                            alt="" class="friend-stats-icon">
                                                        <div class="report-card-data">
                                                            <span class="report-val" id="report-heart">32</span>
                                                            <span class="report-desc">Hearts Collected</span>
                                                        </div>
                                                    </div>
                                                    <div class="report-card-item">
                                                        <img src="../static/resources/images/dashboard/leaderboard-icon.png"
                                                            alt="" class="friend-stats-icon">
                                                        <div class="report-card-data">
                                                            <span class="report-val" id="report-leaderboard">32</span>
                                                            <span class="report-desc">Top 10 finishes</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- <hr> -->

                                            <!-- <hr> -->
                                            <div class="temp-con">
                                                <span class="less-imp-text">Actions-Zone</span>
                                                <div class="friend-action">
                                                    <button class="ui-button-3" id="frnd-rmv">
                                                        <span class="material-symbols-outlined"
                                                            style="font-size: 28px;">
                                                            person_remove
                                                        </span>&nbsp;Unfriend
                                                    </button>
                                                    <button class="ui-button-3" id="frnd-stk">
                                                        <span class="material-symbols-outlined"
                                                            style="font-size: 28px;">
                                                            bolt
                                                        </span>&nbsp;Send Request
                                                    </button>
                                                </div>
                                            </div>
                                            <!-- <div class="friend-stats">
                                                <div class="frnd-stat" id="frnd-streak"></div>
                                                <div class="frnd-stat" id="frnd-xp"></div>
                                                <div class="frnd-stat" id="frnd-hearts"></div>
                                                <div class="frnd-stat" id="frnd-top"></div>
                                            </div> -->
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!-- <div class="container-friends-list container-default" id="container-friends-list">

                            </div> -->
                        </div>
                        <!-- <div class="container-daily-tasks container-default">

                    </div> -->
                        <div class="container-groups">
                            <div class="secondary-heading">Groups</div>
                            <div class="group-display-container container-default">
                                <div class="group-list">
                                    <div class="group-search smart-input-container">
                                        <span class="material-symbols-outlined" style="font-size: 24px;">
                                            search
                                        </span>
                                        <input type="text" name="" id="group-search-input" placeholder="Search Groups">
                                    </div>
                                    <script>
                                        const groupSearchInput = document.getElementById('group-search-input');
                                        groupSearchInput.addEventListener('keyup', function (event) {
                                            // Call the function to generate user group list'
                                            const searchText = groupSearchInput.value;
                                            generateUserGroupsList(searchText);
                                        });
                                    </script>
                                    <div class="group-list-container">
                                        <a class="grp-lst-item" href="#">
                                            <div class="grp-logo">
                                                Jb
                                            </div>
                                            <div class="grp-desc">
                                                <span class="grp-name">Jacob's Group</span>
                                                <span class="grp-admin">Jacob</span>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div class="group-details">
                                    <div class="empty-state" id="group-empty-state">
                                        Select a group to view details
                                    </div>
                                    <div class="selected-group-info">
                                        <div class="group-header">
                                            <div class="group-title">
                                                <span class="grp-name" id="grp-name" style="text-align: left;">Jacob
                                                    Bhai Nu Group</span>
                                                <span class="grp-members less-imp-text" style="color: var(--hare);"
                                                    id="grp-members">98 members</span>
                                            </div>
                                            <button class="group-info ui-button" id="group-info-more">
                                                <span class="material-symbols-outlined" style="font-size: 24px;">
                                                    more_horiz
                                                </span>
                                            </button>
                                            <script>
                                                const groupInfoButton = document.getElementById("group-info-more");

                                                groupInfoButton.addEventListener("click", async function () {
                                                    try {
                                                        // Perform asynchronous action here
                                                        const template = document.querySelector(".group-handle-con-back");
                                                        const manager = document.querySelector(".group-handle-con");
                                                        const groupName = document.querySelector("#handle-grp-name");
                                                        groupName.textContent = manager.dataset.grpN;
                                                        const addMember = document.querySelector("#add-member");
                                                        const delGroup = document.querySelector("#del-group");
                                                        addMember.style.display = manager.dataset.isUserAdmin == 'true' ? 'flex' : 'none';
                                                        delGroup.style.display = manager.dataset.isUserAdmin == 'true' ? 'flex' : 'none';

                                                        // console.log(manager.dataset.grpN);
                                                        template.style.display = "flex";
                                                        generateManagerList(manager.dataset.grpN, manager.dataset.grpI, manager.dataset.isUserAdmin);
                                                        generateExFriendsList('.add-member-list');

                                                    } catch (error) {
                                                        console.error('An error occurred:', error);
                                                        // Handle errors
                                                    }

                                                });
                                                async function generateManagerList(grpN, grpI, isUserAdmin) {
                                                    try {
                                                        const response = await fetch('/get-grp-members', {
                                                            method: 'POST',
                                                            headers: {
                                                                'Content-Type': 'application/json'
                                                            },
                                                            body: JSON.stringify({ group_id: grpI })
                                                        });
                                                        if (!response.ok) {
                                                            throw new Error('Failed to fetch members');
                                                        }
                                                        const grpMembers = await response.json();
                                                        console.log(grpMembers);
                                                        const groupMemberList = document.querySelector(".group-member-list");
                                                        groupMemberList.innerHTML = '';

                                                        grpMembers.forEach((name, index) => {
                                                            // Create elements for each member
                                                            const groupMemberItem = document.createElement('div');
                                                            groupMemberItem.classList.add('group-member-item');
                                                            groupMemberItem.dataset.name = name;
                                                            const memberNameSpan = document.createElement('span');
                                                            const manager = document.querySelector(".group-handle-con");
                                                            memberNameSpan.classList.add('grp-member-name');
                                                            memberNameSpan.textContent = name;
                                                            // console.log("Mera jhoota hai Japani");
                                                            console.log(isUserAdmin + "Value of IUA" + typeof (isUserAdmin));
                                                            const res = manager.dataset.isUserAdmin;
                                                            console.log(res + "It is it's result" + typeof (res));
                                                            if (res == 'true') {
                                                                const grpMemberAction = document.createElement('div');
                                                                grpMemberAction.classList.add('grp-member-action');

                                                                const removeButton = document.createElement('button');
                                                                removeButton.classList.add('ui-button-2', 'remove-group-member');
                                                                removeButton.addEventListener('click', async function () {
                                                                    await removeGrpMember(grpI, groupMemberItem.dataset.name, grpN, isUserAdmin);
                                                                    await generateManagerList(grpN, grpI, isUserAdmin);
                                                                    await generateExFriendsList('.add-member-list');
                                                                });

                                                                const materialSymbol = document.createElement('span');
                                                                materialSymbol.classList.add('material-symbols-outlined');
                                                                materialSymbol.style.color = 'var(--cardinal)';
                                                                materialSymbol.style.fontSize = '24px';
                                                                materialSymbol.textContent = 'person_remove';
                                                                removeButton.appendChild(materialSymbol);
                                                                grpMemberAction.appendChild(removeButton);

                                                                // Append elements to their respective parent
                                                                groupMemberItem.appendChild(memberNameSpan);
                                                                groupMemberItem.appendChild(grpMemberAction);
                                                            } else {
                                                                // Append elements to their respective parent
                                                                groupMemberItem.appendChild(memberNameSpan);
                                                            }
                                                            groupMemberList.appendChild(groupMemberItem);
                                                        });

                                                    } catch (error) {
                                                        console.error('Error fetching friend requests:', error);
                                                    }

                                                }

                                                async function removeGrpMember(grpI, name, grpN, isUserAdmin) {
                                                    try {
                                                        const requestBody = {
                                                            group_id: grpI,
                                                            member_name: name // Include 'name' parameter in the request body
                                                        };
                                                        const response = await fetch('/remove-grp-member', {
                                                            method: 'POST',
                                                            headers: {
                                                                'Content-Type': 'application/json'
                                                            },
                                                            body: JSON.stringify(requestBody)
                                                        });
                                                        if (!response.ok) {
                                                            throw new Error('Failed to fetch members');
                                                        } else {
                                                            // generateManagerList(grpN, grpI, isUserAdmin);
                                                            // generateExFriendsList('.add-member-list');
                                                        }
                                                        const grpMembers = await response.json();
                                                    } catch (error) {
                                                        console.log(error.message)
                                                    }
                                                }

                                            </script>
                                        </div>
                                        <div class="group-task-list">
                                            <div class="group-task-item ">
                                                <div class="group-task-item-main">
                                                    <span class="grp-task-name">
                                                        <span class="grp-tsk-name">Task to do! Two thousand rupees are
                                                            pending and that is why we lost every match</span>
                                                    </span>
                                                    <div class="grp-most-actions">
                                                        <span class="grp-task-elapse less-imp-text">10mins left</span>
                                                        <span class="grp-task-status">
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                progress_activity
                                                            </span>
                                                            50%
                                                        </span>
                                                        <button class="mark-as-complete  ui-button-2">
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                done_all
                                                            </span>
                                                        </button>
                                                        <button class="del-grp-tsk ui-button-2">
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                delete
                                                            </span>
                                                        </button>
                                                        <button class="task-det-handle ui-button-2">
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                expand_more
                                                            </span>
                                                        </button>
                                                    </div>
                                                </div>


                                                <div class="task-more-info info-popup">
                                                    <!-- <span
                                                            style="display: flex;flex-direction: row; align-items: center;font-weight: 600; gap: 5px; background-color: var(--feather-green); color: var(--snow); text-align: center; padding: 5px;">
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px; font-weight: 600; ">
                                                                subtitles
                                                            </span>Task Details
                                                        </span> -->
                                                    <div class="task-member-status">
                                                        <div class="task-member">
                                                            <span class="task-member-name">John Doe</span>
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                done_all
                                                            </span>
                                                        </div>
                                                        <div class="task-member">
                                                            <span class="task-member-name">John Doe</span>
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                done_all
                                                            </span>
                                                        </div>
                                                        <div class="task-member">
                                                            <span class="task-member-name">John Doe</span>
                                                            <span class="material-symbols-outlined"
                                                                style="font-size: 24px;">
                                                                done_all
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="task-calendar">
                                                        <span class="create-date">Mon, Feb 26, 2024</span>
                                                        <span class="material-symbols-outlined"
                                                            style="font-size: 18px;">
                                                            width
                                                        </span>
                                                        <span class="complete-date">Tue, Feb 27, 2024</span>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="group-tsk-crt-con smart-input-container">
                                            <input type="text" name="" id="grp-tsk-add-field"
                                                placeholder="Create a new task..." style="flex: 1;" />
                                            <input type="date" id="date-task-completion" name="date" min="" max=""
                                                required>
                                            <button id="create-grp-task-btn" title="Add Task">
                                                <span class="material-symbols-outlined" style="font-size: 24px;">
                                                    add_task
                                                </span>
                                            </button>
                                            <div class="alert-box-warn" id="group-tsk-crt-alert">
                                                <span class="material-symbols-outlined"
                                                    style="font-size: 24px; color: var(--cardinal);">
                                                    warning
                                                </span>
                                                <span id="grp-tsk-warn">

                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            const createTaskButton = document.getElementById("create-grp-task-btn");
                            const grpTskAlert = document.getElementById("group-tsk-crt-alert");
                            const grpTskField = document.getElementById("grp-tsk-add-field");
                            createTaskButton.addEventListener("click", async function () {
                                // Get task name
                                var taskName = document.getElementById("grp-tsk-add-field").value;

                                // Get completion date
                                var completionDate = document.getElementById("date-task-completion").value;
                                if (completionDate == "" || taskName == "") {
                                    const alrtBox = document.querySelector('#group-tsk-crt-alert');
                                    alrtBox.style.display = 'flex';
                                    const alrtIco = document.querySelector('#group-tsk-crt-alert > .material-symbols-outlined');
                                    alrtIco.textContent = "warning";
                                    alrtIco.style.color = 'var(--bee-mask)';
                                    const alrtSpan = document.querySelector('#group-tsk-crt-alert > #grp-tsk-warn');
                                    alrtSpan.textContent = "Please check Task and Date";
                                    setTimeout(function () {
                                        alrtBox.style.display = 'none';
                                    }, 3000)
                                } else {
                                    var grpId = createTaskButton.dataset.grpId; // Example: You can replace this with the actual value of your additional data attribute
                                    var grpName = createTaskButton.dataset.grpName; // Example: You can replace this with the actual value of your additional data attribute
                                    var isUserAdmin = createTaskButton.dataset.isUsrAdmin;
                                    // Call the createGroupTask function with the retrieved values
                                    var res = await createGroupTask(grpId, grpName, taskName, completionDate);
                                    if (res.message == "Task created successfully") {
                                        const alrtBox = document.querySelector('#group-tsk-crt-alert');
                                        alrtBox.style.display = 'flex';
                                        const alrtIco = document.querySelector('#group-tsk-crt-alert > .material-symbols-outlined');
                                        alrtIco.textContent = "done";
                                        alrtIco.style.color = 'var(--feather-green)'
                                        const alrtSpan = document.querySelector('#group-tsk-crt-alert > #grp-tsk-warn');
                                        alrtSpan.textContent = "Task Created Succesfully";
                                        setTimeout(function () {
                                            alrtBox.style.display = 'none';
                                        }, 3000)
                                        generateGrpTsk(grpId, isUserAdmin);
                                        taskName.value = "";
                                        completionDate.value = "";
                                    }
                                }
                                // Get additional data attributes (if any)
                            });
                        </script>
                        <script>
                            // Get current date
                            const currentDate = new Date();

                            // Calculate one week ahead date
                            const oneWeekAhead = new Date();
                            oneWeekAhead.setDate(currentDate.getDate() + 30);

                            // Format the dates as strings in YYYY-MM-DD format
                            const formattedCurrentDate = currentDate.toISOString().split('T')[0];
                            const formattedOneWeekAhead = oneWeekAhead.toISOString().split('T')[0];

                            // Set min and max attributes of the date input field
                            document.getElementById("date-task-completion").setAttribute("min", formattedCurrentDate);
                            document.getElementById("date-task-completion").setAttribute("max", formattedOneWeekAhead);
                        </script>
                        <script>
                            function generateTaskView() {
                                // Create the main container element
                                var groupTaskItem = document.createElement('div');
                                groupTaskItem.className = 'group-task-item';

                                // Create the main div for task item
                                var groupTaskItemMain = document.createElement('div');
                                groupTaskItemMain.className = 'group-task-item-main';

                                // Create the span element for task name
                                var taskNameSpan = document.createElement('span');
                                taskNameSpan.className = 'grp-task-name';
                                var taskName = document.createElement('span');
                                taskName.className = 'grp-tsk-name';
                                taskName.textContent = 'Task to do!';
                                var taskElapse = document.createElement('span');
                                taskElapse.className = 'grp-task-elapse less-imp-text';
                                taskElapse.textContent = '10mins left';
                                taskNameSpan.appendChild(taskName);
                                taskNameSpan.appendChild(taskElapse);

                                // Create the span element for task status
                                var taskStatusSpan = document.createElement('span');
                                taskStatusSpan.className = 'grp-task-status';
                                var progressSymbol = document.createElement('span');
                                progressSymbol.className = 'material-symbols-outlined';
                                progressSymbol.style.fontSize = '24px';
                                progressSymbol.textContent = 'progress_activity';
                                taskStatusSpan.appendChild(progressSymbol);

                                // Create a span element for the percentage text
                                var percentageText = document.createElement('span');
                                percentageText.textContent = '50%';

                                // Append both progress symbol and percentage text to the taskStatusSpan
                                taskStatusSpan.appendChild(progressSymbol);
                                taskStatusSpan.appendChild(percentageText);

                                // Create the button element for marking as complete
                                var markAsCompleteBtn = document.createElement('button');
                                markAsCompleteBtn.className = 'mark-as-complete ui-button-2';
                                var doneAllSymbol = document.createElement('span');
                                doneAllSymbol.className = 'material-symbols-outlined';
                                doneAllSymbol.style.fontSize = '24px';
                                doneAllSymbol.textContent = 'done_all';
                                markAsCompleteBtn.appendChild(doneAllSymbol);

                                // Create the button element for marking as complete
                                var delTskBtn = document.createElement('button');
                                delTskBtn.className = 'del-grp-tsk ui-button-2';
                                var deleteSymbol = document.createElement('span');
                                deleteSymbol.className = 'material-symbols-outlined';
                                deleteSymbol.style.fontSize = '24px';
                                deleteSymbol.textContent = 'delete';
                                delTskBtn.appendChild(deleteSymbol);

                                // Create the button element for task details
                                var taskDetailsBtn = document.createElement('button');
                                taskDetailsBtn.className = 'task-det-handle ui-button-2';
                                var expandMoreSymbol = document.createElement('span');
                                expandMoreSymbol.className = 'material-symbols-outlined';
                                expandMoreSymbol.style.fontSize = '24px';
                                expandMoreSymbol.textContent = 'expand_more';
                                taskDetailsBtn.appendChild(expandMoreSymbol);

                                // Append all child elements to the main container
                                groupTaskItemMain.appendChild(taskNameSpan);
                                groupTaskItemMain.appendChild(taskStatusSpan);
                                groupTaskItemMain.appendChild(markAsCompleteBtn);
                                groupTaskItemMain.appendChild(delTskBtn);
                                groupTaskItemMain.appendChild(taskDetailsBtn);

                                // Create the container for additional task information
                                var groupTaskItemInfo = document.createElement('div');
                                groupTaskItemInfo.className = 'group-task-item-info';

                                // Create the div for task more information
                                var taskMoreInfoDiv = document.createElement('div');
                                taskMoreInfoDiv.className = 'task-more-info info-popup';

                                // Create the div for task member status
                                var taskMemberStatusDiv = document.createElement('div');
                                taskMemberStatusDiv.className = 'task-member-status';

                                // Create task member elements
                                for (var i = 0; i < 60; i++) {
                                    var taskMemberDiv = document.createElement('div');
                                    taskMemberDiv.className = 'task-member';
                                    var taskMemberNameSpan = document.createElement('span');
                                    taskMemberNameSpan.className = 'task-member-name';
                                    taskMemberNameSpan.textContent = 'John Doe';
                                    var doneAllSymbolForMember = document.createElement('span');
                                    doneAllSymbolForMember.className = 'material-symbols-outlined';
                                    doneAllSymbolForMember.style.fontSize = '24px';
                                    doneAllSymbolForMember.textContent = 'done_all';
                                    taskMemberDiv.appendChild(taskMemberNameSpan);
                                    taskMemberDiv.appendChild(doneAllSymbolForMember);
                                    taskMemberStatusDiv.appendChild(taskMemberDiv);
                                }

                                // Create the div for task calendar
                                var taskCalendarDiv = document.createElement('div');
                                taskCalendarDiv.className = 'task-calendar';
                                var createDateSpan = document.createElement('span');
                                createDateSpan.className = 'create-date';
                                createDateSpan.textContent = 'Mon, Feb 26, 2024';
                                var widthSymbol = document.createElement('span');
                                widthSymbol.className = 'material-symbols-outlined';
                                widthSymbol.style.fontSize = '18px';
                                widthSymbol.textContent = 'width';
                                var completeDateSpan = document.createElement('span');
                                completeDateSpan.className = 'complete-date';
                                completeDateSpan.textContent = 'Tue, Feb 27, 2024';
                                taskCalendarDiv.appendChild(createDateSpan);
                                taskCalendarDiv.appendChild(widthSymbol);
                                taskCalendarDiv.appendChild(completeDateSpan);

                                // Append all child elements to the task more information div
                                taskMoreInfoDiv.appendChild(taskMemberStatusDiv);
                                taskMoreInfoDiv.appendChild(taskCalendarDiv);

                                // Append the main elements to the main container
                                groupTaskItem.appendChild(groupTaskItemMain);
                                groupTaskItem.appendChild(groupTaskItemInfo);
                                groupTaskItemInfo.appendChild(taskMoreInfoDiv);

                                // Append the main container to the document body or any other parent element as needed
                                const container = document.querySelector('.group-task-list');
                                container.appendChild(groupTaskItem);
                            }
                            generateTaskView();

                            // Add event listener to the document and delegate it to dynamically created elements


                        </script>

                        <div class="group-handle-con-back">
                            <div class="group-handle-con container-default">
                                <div class="group-handle-heading">
                                    <div class="group-view-select">
                                        <!-- <button id="view-member" class="ui-button-3">Members</button> -->
                                        <span id="handle-grp-name" class="secondary-heading">Maru Potanu Group</span>
                                        <button id="add-member" class="ui-button-2"><span
                                                class="material-symbols-outlined" style="font-size: 24px;">
                                                group_add
                                            </span></button>
                                        <button id="del-group" class="ui-button-2"><span
                                                class="material-symbols-outlined" style="font-size: 24px;">
                                                delete
                                            </span>
                                        </button>
                                    </div>
                                    <button id="handle-grp-close" class="ui-button-2">
                                        <span class="material-symbols-outlined"
                                            style="font-size: 24px; color: var(--cardinal);">
                                            close
                                        </span>
                                    </button>
                                    <script>
                                        const closeButton = document.getElementById("handle-grp-close");

                                        // Add event listener for "click" event
                                        closeButton.addEventListener("click", function () {
                                            // Select the element with the class "group-handle-con-back"
                                            const groupHandleConBack = document.querySelector(".group-handle-con-back");

                                            // Set the display of the element to "none"
                                            groupHandleConBack.style.display = "none";
                                        });

                                        const delGroupButton = document.querySelector("#del-group");
                                        delGroupButton.addEventListener('click', async function () {
                                            try {
                                                // Call the deleteGroup function
                                                const groupManager = document.querySelector('.group-handle-con');

                                                const res = await deleteGroup(groupManager.dataset.grpI, groupManager.dataset.isUserAdmin);
                                                if (res) {
                                                    generateUserGroupsList("");
                                                    const groupHandleConBack = document.querySelector(".group-handle-con-back");
                                                    const eS = document.querySelector("#group-empty-state");
                                                    const groupContainer = document.querySelector(".selected-group-info");
                                                    groupHandleConBack.style.display = "none";
                                                    eS.style.display = "flex";
                                                    groupContainer.style.display = "none";

                                                }
                                            } catch (error) {
                                                console.error('An error occurred:', error);
                                                // Handle errors here
                                            }
                                        });
                                    </script>
                                </div>
                                <div class="group-manager">
                                    <div class="add-member-list">

                                    </div>
                                    <button id="add-btn-grp" class="ui-button-3"
                                        style="font-size: var(--normal-font-size);">
                                        <span class="material-symbols-outlined"
                                            style="font-size: 24px; color: var(--feather-green);">
                                            group_add
                                        </span>&nbsp;Member's
                                    </button>
                                    <div class="group-member-list">
                                        <div class="group-member-item">
                                            <span class="grp-member-name">Member 1</span>
                                            <div class="grp-member-action">
                                                <button class="ui-button-2 remove-group-member">
                                                    <span class="material-symbols-outlined"
                                                        style="color: var(--cardinal); font-size: 24px;">
                                                        person_remove
                                                    </span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="background-blur"></div>
                        </div>
                        <script>
                            const addButton = document.getElementById('add-member');
                            let isAddMember = false;
                            // Add an event listener to the button
                            addButton.addEventListener('click', async function () {
                                // Call a function when the button is clicked
                                const manager = document.querySelector(".group-handle-con");
                                event.preventDefault();
                                if (!isAddMember) {
                                    addButton.innerHTML = `<span class="material-symbols-outlined" style="font-size: 24px; color: var(--hare);">arrow_back</span>`;
                                    const memberList = document.querySelector(".group-member-list");
                                    const btn = document.querySelector("#add-btn-grp");
                                    btn.style.display = 'flex';
                                    memberList.style.display = 'none';
                                    addButton.style.color = 'var(--hare)';
                                    const addMemberList = document.querySelector(".add-member-list");
                                    addMemberList.style.display = 'flex';
                                    addMemberList.style.margin = "auto";
                                    isAddMember = true;
                                    // generateManagerList(manager.dataset.grpN, manager.dataset.grpI, manager.dataset.isUserAdmin);
                                    // await generateExFriendsList('.add-member-list');
                                } else {
                                    addButton.innerHTML = `<span class="material-symbols-outlined" style="font-size: 24px;">group_add</span>`;
                                    const memberList = document.querySelector(".group-member-list");
                                    const btn = document.querySelector("#add-btn-grp");
                                    btn.style.display = 'none';
                                    memberList.style.display = 'flex';
                                    const addMemberList = document.querySelector(".add-member-list");
                                    addMemberList.style.display = 'none'
                                    isAddMember = false;
                                    // await generateManagerList(manager.dataset.grpN, manager.dataset.grpI, manager.dataset.isUserAdmin);

                                }
                                // For example, you can call a function to handle adding a member
                            });
                        </script>
                    </div>
                    <div class="container-leaderboards" id="container-leaderboards">
                        <div class="title-dashboard">Leaderboards</div>
                    </div>
                </content-container>
                <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        const linkIds = ['link-home', 'link-leaderboards', 'link-profile', 'link-preferences'];
                        const containerIds = ['container-home', 'container-leaderboards', 'container-profile', 'container-preferences'];
                        const sideContainerIds = ['notification-container', 'daily-tasks-container', 'friends-container-side']
                        function viewManager(position) {

                            // Hide all containers
                            containerIds.forEach(id => {
                                document.getElementById(id).style.display = 'none';
                            });
                            sideContainerIds.forEach(id => {
                                document.getElementById(id).style.display = 'none';
                            });
                            if (position == 0) {
                                document.getElementById(sideContainerIds[0]).style.display = 'flex';
                                document.getElementById(sideContainerIds[1]).style.display = 'flex';

                            }
                            if (position == 2) {
                                document.getElementById(sideContainerIds[2]).style.display = 'flex';
                            }
                            if (position == 0 || position === 2) {
                                document.getElementById(containerIds[position]).style.display = 'grid';

                            } else {
                                document.getElementById(containerIds[position]).style.display = 'flex';
                            }
                            // Show the container corresponding to the given position
                        }

                        // Call viewManager with 0 to show container-home by default
                        viewManager(3);

                        // Add event listeners to links to call viewManager with the corresponding position
                        linkIds.forEach((id, index) => {
                            const link = document.getElementById(id);
                            if (link) {
                                link.addEventListener('click', function (event) {
                                    event.preventDefault(); // Prevent default link behavior
                                    viewManager(index);
                                });
                            } else {
                                console.error('Element with ID ' + id + ' not found.');
                            }
                        });
                    });
                </script>
                <extras-container>
                    <div class="stats-container container-default">
                        <div class="stat">
                            <img class="stat-icon" src="../static/resources/images/dashboard/streak-icon.png" alt="">
                            <stat class="stat-value sub-heading" id="streaks-stat"></stat>
                        </div>
                        <div class="stat">
                            <img class="stat-icon" src="../static/resources/images/dashboard/gems-icon.png" alt="">
                            <stat class="stat-value sub-heading" id="gems-stat"></stat>
                        </div>
                        <div class="stat">
                            <img class="stat-icon" src="../static/resources/images/dashboard/heart-icon.png" alt="">
                            <stat class="stat-value sub-heading" id="hearts-stat"></stat>
                        </div>
                    </div>
                    <div class="notification-container container-default" id="notification-container">
                        <div class="secondary-heading">Notifications</div>
                        <div class="notification-social-reqs">
                        </div>
                    </div>
                    <div class="daily-tasks-container  container-default" id="daily-tasks-container">
                        <div class="daily-tasks-container-wrapper">
                            <span class="secondary-heading">Daily Tasks</span>
                            <button id="send-streak-to-friends" class="ui-button-3" disabled>
                                <span class="material-symbols-outlined" style="font-size: 28px;">
                                    bolt
                                </span>
                                Send Streaks
                            </button>
                        </div>
                        <div class="daily-tasks-show">
                            <!-- <div class="daily-task">
                                <div class="daily-task-difficulty">#Important</div>
                                <div class="daily-task-actions">
                                    <button class="mark-complete-daily-task ui-button-2 daily-marked">
                                        <span class="material-symbols-outlined" style="font-size: 28px;">
                                            done_all
                                        </span>
                                    </button>
                                </div>
                                <div class="daily-task-description">
                                    Task1 taski si njimprot
                                </div>
                            </div> -->
                            <!-- <script>
                                var button = document.querySelector('.mark-complete-daily-task');

                                // Add event listener to the button
                                button.addEventListener('click', function () {
                                    // Toggle the 'daily-marked' class
                                    this.classList.toggle('daily-marked');
                                });
                            </script> -->
                        </div>
                    </div>
                    <script>
                        async function markDailyTaskAsComplete(taskId) {
                            try {
                                const response = await fetch('/mark-daily-task-as-complete', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ taskId: taskId })
                                });

                                if (response.ok) {
                                    const data = await response.json();
                                    console.log(data.message); // Log success message
                                    return (data.all_tasks_completed);
                                    // Perform any additional actions if needed
                                } else {
                                    const errorData = await response.json();
                                    console.error('Error:', errorData.error); // Log error message
                                    // Handle error as needed
                                }
                            } catch (error) {
                                console.error('Error:', error); // Log fetch error
                                // Handle error as needed
                            }
                        }

                        var isTasksCompleted = false;
                        var completedTaskList = [];
                        var lengthOfTasks = 0;

                        function awardDailyPoints() {

                        }

                        function countFrequency(arr, element) {
                            let frequency = 0;
                            for (let i = 0; i < arr.length; i++) {
                                if (arr[i] === element) {
                                    frequency++;
                                }
                            }
                            return frequency;
                        }

                        async function generateUserDailyTasksToShow() {
                            const response = await fetchUserDailyTasksToShow();
                            isTasksCompleted = response[1];
                            if (isTasksCompleted) {
                                var btn = document.querySelector('#send-streak-to-friends');
                                btn.disabled = false;
                            }
                            console.log(isTasksCompleted);
                            var parentElement = document.querySelector('.daily-tasks-show');
                            parentElement.textContent = "";
                            var completedTasksElements = [];
                            var index = 0;
                            lengthOfTasks = response[0].length;
                            console.log(lengthOfTasks);
                            if (response[0].length > 0) {
                                response[0].forEach(task => {
                                    completedTaskList.push(task.completed);
                                    console.log(completedTaskList);
                                    var taskDiv = document.createElement('div');
                                    taskDiv.classList.add('daily-task');
                                    taskDiv.dataset.idx = index;
                                    taskDiv.dataset.isCompleted = task.completed;
                                    index++;
                                    var difficultyDiv = document.createElement('div');
                                    difficultyDiv.classList.add('daily-task-difficulty');
                                    if (task.taskPriority == 1) {
                                        difficultyDiv.classList.add("tsk-easy");
                                    } else if (task.taskPriority == 2) {
                                        difficultyDiv.classList.add("tsk-moderate");
                                    } else {
                                        difficultyDiv.classList.add("tsk-important");
                                    }
                                    difficultyDiv.textContent = task.taskPriority == 1 ? "#Easy" : task.taskPriority == 2 ? "#Moderate" : task.taskPriority == 3 ? "#Difficult" : "Value Not Found";

                                    var actionsDiv = document.createElement('div');
                                    actionsDiv.classList.add('daily-task-actions');

                                    var button = document.createElement('button');
                                    button.classList.add('mark-complete-daily-task', 'ui-button-2');
                                    if (task.completed == 1) {
                                        button.classList.add('daily-marked');
                                    }
                                    if (isTasksCompleted == 1) {
                                        button.disabled = true;
                                        button.classList.add('daily-disabled');
                                    }

                                    button.addEventListener('click', async function () {
                                        var tskId = task.taskId;
                                        // console.log(tskId);
                                        if (countFrequency(completedTaskList, 0) == 1 && taskDiv.dataset.isCompleted == 0) {
                                            if (await createConfirmBox("Confirm Task Completion", "Once all tasks are completed and submitted, they will be disabled for today, scores will be finalized, and no further changes will be allowed. Are you sure?")) {
                                                if (taskDiv.dataset.isCompleted == 0) {
                                                    console.log(completedTaskList);
                                                    taskDiv.dataset.isCompleted = 1;
                                                    completedTaskList[taskDiv.dataset.idx] = 1;
                                                    console.log(completedTaskList);
                                                } else {
                                                    console.log(completedTaskList);
                                                    taskDiv.dataset.isCompleted = 0;
                                                    completedTaskList[taskDiv.dataset.idx] = 0;
                                                    console.log(completedTaskList);
                                                }
                                                var res = await markDailyTaskAsComplete(tskId);
                                                console.log(res);
                                                if (res) {
                                                    var completeButtons = document.querySelectorAll('.mark-complete-daily-task');
                                                    completeButtons.forEach(function (button) {
                                                        button.disabled = true;
                                                        button.classList.add('daily-disabled');
                                                    });
                                                    button.classList.toggle('daily-marked');
                                                    console.log("Task Toggled");
                                                    var btn = document.querySelector('#send-streak-to-friends');
                                                    btn.disabled = false;
                                                }
                                            }
                                        } else {
                                            await markDailyTaskAsComplete(tskId);
                                            // console.log(countFrequency(completedTaskList, 0) + "is frequency/");
                                            // if(isAllComplete == true) {
                                            //     awardDailyPoints();
                                            // }
                                            if (taskDiv.dataset.isCompleted == 0) {
                                                console.log(completedTaskList);
                                                taskDiv.dataset.isCompleted = 1;
                                                completedTaskList[taskDiv.dataset.idx] = 1;
                                                console.log(completedTaskList);
                                            } else {
                                                console.log(completedTaskList);
                                                taskDiv.dataset.isCompleted = 0;
                                                completedTaskList[taskDiv.dataset.idx] = 0;
                                                console.log(completedTaskList);
                                            }
                                            this.classList.toggle('daily-marked');
                                        }
                                        if (!this.classList.contains('daily-marked')) {
                                            await parentElement.removeChild(taskDiv);
                                            console.log("Clicked a tick task");
                                            var firstChild = parentElement.firstChild;
                                            console.log(firstChild);
                                            await parentElement.insertBefore(taskDiv, firstChild);
                                            taskDiv.style.backgroundColor = 'var(--polar)';
                                            taskDiv.style.Color = 'var(--eel)';
                                        } else {
                                            taskDiv.style.backgroundColor = 'var(--polar)';
                                            taskDiv.style.Color = 'var(--eel)';
                                            parentElement.appendChild(taskDiv);
                                        }
                                    });

                                    var span = document.createElement('span');
                                    span.classList.add('material-symbols-outlined');
                                    span.style.fontSize = '28px';
                                    span.textContent = 'done_all';

                                    button.appendChild(span);
                                    actionsDiv.appendChild(button);

                                    var descriptionDiv = document.createElement('div');
                                    descriptionDiv.classList.add('daily-task-description');
                                    descriptionDiv.textContent = task.taskName;

                                    taskDiv.appendChild(difficultyDiv);
                                    taskDiv.appendChild(actionsDiv);
                                    taskDiv.appendChild(descriptionDiv);

                                    if (task.completed == 0) {
                                        parentElement.appendChild(taskDiv); // If task is not completed, append normally
                                    } else {
                                        completedTasksElements.push(taskDiv); // If task is completed, it will be moved to the end later
                                    }
                                });
                                const seq = document.createElement('div');
                                seq.textContent = 'Completed-Items'; // Clear existing fields
                                seq.className = 'less-imp-text';
                                seq.style.margin = "0 auto";
                                parentElement.appendChild(seq);
                                completedTasksElements.forEach(function (taskDiv) {
                                    parentElement.appendChild(taskDiv);
                                });
                            } else {
                                var parentElement = document.querySelector('.daily-tasks-show');
                                parentElement.textContent = "";

                                var span = document.createElement('span');
                                span.classList.add('less-imp-text');
                                span.textContent = "No Tasks To Show";
                                span.style.margin = "10px auto";
                                parentElement.appendChild(span);
                            }
                        }
                        async function fetchUserDailyTasksToShow() {
                            try {
                                const response = await fetch('/fetch-user-daily-tasks-to-show', {
                                    method: 'GET',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                });
                                if (!response.ok) {
                                    throw new Error('Failed to fetch user daily tasks');
                                }
                                const tasks = await response.json();
                                // Handle the fetched tasks
                                return tasks;
                                // Process tasks and update UI as needed
                            } catch (error) {
                                console.error('Error fetching user daily tasks:', error);
                                // Handle errors as needed
                            }
                        }
                    </script>
                    <div id="friends-container-side" class="friends-container-side container-default">
                        <div class="secondary-heading">Add Friends</div>
                        <div class="add-friends-container">
                            <span class="material-symbols-outlined" style="font-size: 24px;">
                                search
                            </span>
                            <input type="text" placeholder="Friend's Username" name="friend-username"
                                id="friend-username">
                            <!-- <span id="friend-search-status">
                                
                            </span> -->
                            <button type="submit" id="add-friend-btn" style="cursor: pointer; color: var(--polar);">
                                <span class="material-symbols-outlined" id="send-btn-frnd" style="font-size: 24px;">
                                    send
                                </span>
                            </button>
                            <div class="alert-box-warn" id="alert-friend-form" popover>

                            </div>
                        </div>
                    </div>
                    <div class="groups-container-side container-default" id="groups-container-side">
                        <div class="secondary-heading">Create Group</div>
                        <div class="create-groups-container" style="gap: 5px; align-items: center;">
                            <span class="material-symbols-rounded" style="font-size: 24px;">
                                diversity_1
                            </span>
                            <input type="text" placeholder="Groups Name" name="group-name" id="group-name">
                            <button id="create-group-btn" style="cursor: pointer; color: var(--polar);">
                                <span class="material-symbols-outlined" style="font-size: 24px;">
                                    send
                                </span>
                            </button>
                            <div class="alert-box-warn" id="alert-group-form" popover>

                            </div>
                        </div>
                        <script>
                            document.getElementById("group-name").addEventListener("input", async function () {
                                var groupname = this.value;

                                // console.log(username);
                                if (groupname == "") {
                                    document.getElementById("create-group-btn").style.color = "var(--polar)";
                                    // document.getElementById("group-name").disabled = true;
                                    // document.getElementById("friend-search-status").innerHTML = "";
                                    // document.getElementById("friend-search-status").style.backgroundColor = "var(--snow)";

                                } else {
                                    var res = await checkGroupname(groupname);
                                    // console.log(res);
                                    if (res) {
                                        document.getElementById("create-group-btn").style.color = "var(--feather-green)";

                                        // document.getElementById("friend-search-status").textContent = "Found";
                                        // document.getElementById("friend-search-status").style.backgroundColor = "var(--feather-green)";
                                        // alert("User Found");
                                    } else {
                                        document.getElementById("create-group-btn").style.color = "var(--cardinal)";

                                        // document.getElementById("friend-search-status").textContent = "Not Found";
                                        // document.getElementById("friend-search-status").style.backgroundColor = "var(--cardinal)";
                                    }
                                }
                            });
                        </script>
                        <div class="less-imp-text" style="text-align: center; margin: 10px 0;">Add Group Members</div>
                        <div class="group-member-add-list">
                            <!-- <div class="grp-member-item">
                                <input type="checkbox" name="" id="friend-${friend}" data-friend="${friend}">
                                <label for="friend-${friend}">${friend}</label>
                            </div> -->
                        </div>
                    </div>
                    <div class="friends-list-side container-default" id="friends-list-side">
                        <div class="secondary-heading">Streaks with Friends</div>
                    </div>
                    <script>
                        document.getElementById("friend-username").addEventListener("input", async function () {
                            var username = this.value;
                            // console.log(username);
                            if (username == "") {
                                document.getElementById("send-btn-frnd").style.color = "var(--hare)";
                                document.getElementById("send-btn-frnd").disabled = true;
                                // document.getElementById("friend-search-status").innerHTML = "";
                                // document.getElementById("friend-search-status").style.backgroundColor = "var(--snow)";

                            } else {
                                var res = await checkUsername(username);
                                // console.log(res);
                                if (res) {
                                    document.getElementById("send-btn-frnd").style.color = "var(--feather-green)";

                                    // document.getElementById("friend-search-status").textContent = "Found";
                                    // document.getElementById("friend-search-status").style.backgroundColor = "var(--feather-green)";
                                    // alert("User Found");
                                } else {
                                    document.getElementById("send-btn-frnd").style.color = "var(--cardinal)";

                                    // document.getElementById("friend-search-status").textContent = "Not Found";
                                    // document.getElementById("friend-search-status").style.backgroundColor = "var(--cardinal)";
                                }
                            }
                        });
                    </script>
                    <div class="heading" id="homo"></div>
                </extras-container>
            </main-content-container>
        </main-content-wrapper>
    </main-container>
    <!-- <div class="confirm-box-container">
        <div class="confirm-box-main container-default">
            <span class="confirm-box-heading">
                Confirm Task Completion
            </span>
            <span class="confirm-box-content less-imp-text">Lorem ipsum dolor sit, amet consectetur adipisicing elit.
                Eaque quisquam tenetur ipsa facilis sapiente hic corrupti doloremque aliquam omnis delectus?</span>
            <div class="confirm-box-actions">
                <button id="confirm-box-cancel" class="confirm-box-btn">Cancel</button>
                <button id="confirm-box-confirm" class="confirm-box-btn">OK</button>
            </div>
        </div>
    </div> -->
    <script>
        function createConfirmBox(heading, content) {
            return new Promise((resolve, reject) => {
                // Create elements for custom confirmation dialog
                const container = document.createElement('div');
                container.classList.add('confirm-box-container');

                // Create main confirm box element
                const confirmBoxMain = document.createElement('div');
                confirmBoxMain.classList.add('confirm-box-main', 'container-default');

                // Create heading element
                const headingElement = document.createElement('span');
                headingElement.classList.add('confirm-box-heading');
                headingElement.textContent = heading;

                // Create content element
                const contentElement = document.createElement('span');
                contentElement.classList.add('confirm-box-content', 'less-imp-text');
                contentElement.textContent = content;

                // Create actions container
                const actionsContainer = document.createElement('div');
                actionsContainer.classList.add('confirm-box-actions');

                // Create cancel button
                const cancelButton = document.createElement('button');
                cancelButton.setAttribute('id', 'confirm-box-cancel');
                cancelButton.classList.add('confirm-box-btn');
                cancelButton.textContent = 'Cancel';

                // Create confirm button
                const confirmButton = document.createElement('button');
                confirmButton.setAttribute('id', 'confirm-box-confirm');
                confirmButton.classList.add('confirm-box-btn');
                confirmButton.textContent = 'OK';

                cancelButton.addEventListener('click', () => {
                    resolve(false); // Resolve with false when Cancel button is clicked
                    document.body.removeChild(container); // Remove the confirm box from the DOM
                });
                confirmButton.addEventListener('click', () => {
                    resolve(true); // Resolve with true when OK button is clicked
                    document.body.removeChild(container); // Remove the confirm box from the DOM
                });

                // Append elements
                actionsContainer.appendChild(cancelButton);
                actionsContainer.appendChild(confirmButton);
                confirmBoxMain.appendChild(headingElement);
                confirmBoxMain.appendChild(contentElement);
                confirmBoxMain.appendChild(actionsContainer);
                container.appendChild(confirmBoxMain);
                document.body.appendChild(container);
                container.style.opacity = '100';
            });
        }
    </script>
    <script>

    </script>
    <script>
        var currentUser = null;

        // Function to toggle active class of side navigation
        function toggleActive(event) {
            // Prevent default link behavior
            event.preventDefault();

            // Remove active class from all links
            const links = document.querySelectorAll('.nav-list-item-link');
            links.forEach(link => link.classList.remove('active'));

            // Add active class to the clicked link
            event.currentTarget.classList.add('active');
        }




        // Script for Pomodoro
        const timeDisplayMin = document.getElementById('time-min');
        const timeDisplaySec = document.getElementById('time-sec');
        const startButton = document.getElementById('start');
        const stopButton = document.getElementById('stop');
        const resetButton = document.getElementById('reset');
        let user_sequences;
        async function initializeUserSequences() {
            try {
                let user = await getUser();
                userSequences = user.pomodoro_sequences;
                // console.log("user sequences", userSequences);
                // console.log("user sequences", userSequences);
                // userSequences = [
                //     [25, 5, 25, 5, 25, 30],
                //     [60, 10, 60, 10, 60, 30],
                //     [55, 15, 45, 10, 30, 60]
                // ]
                // console.log(userSequences[1] + "Thsi si is is is isi si ");
                return userSequences;

                // Now you can use the user object and its properties
                // Start your timer or perform any other operations based on the user data
            } catch (error) {
                console.error('Error initializing user:', error);
            }
        }



        // user_sequences.then(result => {
        //     // Iterate over each array in the result
        //     result.forEach((sequence, index) => {
        //         console.log(`Sequence ${index + 1}:`, sequence);
        //         // Access elements of each sequence array
        //         sequence.forEach((element, subIndex) => {
        //             console.log(`Element ${subIndex + 1}:`, element);
        //         }); 
        //     });
        // });
        // console.log("user sequences", user_sequences);

        let isWorkTime = true;
        let secondsLeft;
        let timerInterval;
        let sequencesLength;
        let timeSequence = [25, 5];
        let sequenceIndex = 0;

        async function updateSequences() {
            user_sequences = await initializeUserSequences();
            sequencesLength = user_sequences.length;
            // console.log("sequences length", sequencesLength);
            // console.log(user_sequences[0]);
            // user_sequences.then(result => {
            //     user_sequences = result;
            //     // document.getElementById('homo').textContent = result[1][sequenceIndex];
            // });
            generateSequenceFields();
            generatePomodoroSelectors();
        }

        // function updateSequences() {
        //     try {
        //         user_sequences = initializeUserSequences();
        //         sequencesLength = user_sequences.length;
        //         // user_sequences = result;
        //         // user_sequences.then(result => {
        //         //     sequencesLength = result.length;
        //         //     // document.getElementById('homo').textContent = result[1][sequenceIndex];

        //         //     // generateSequenceFields();
        //         // });
        //         generatePomodoroSelectors();
        //         generateSequenceFields();
        //     } catch (error) {
        //         console.error('Error updating sequences:', error);
        //     }
        // }

        function generateSequenceFields() {
            const container = document.querySelector('.user-pomodoro-form-sequence');
            container.innerHTML = ''; // Clear existing fields
            // const seq = document.createElement('div');
            // seq.textContent = 'Your Sequences '; // Clear existing fields
            // seq.className = 'secondary-heading';
            // container.appendChild(seq);
            // Loop through the user_sequences and generate input fields
            user_sequences.forEach((sequence, index) => {
                const sequenceInput = document.createElement('input');
                sequenceInput.type = 'text';
                sequenceInput.className = "smart-input-container";
                sequenceInput.name = `sequence[]`; // Set unique name for each input field
                sequenceInput.value = sequence.join(', '); // Populate input field with sequence data
                container.appendChild(sequenceInput); // Append input field to container
            });
            const seq = document.createElement('div');
            seq.textContent = 'End-Of-List'; // Clear existing fields
            seq.className = 'less-imp-text';
            seq.style.margin = "0 auto";
            container.appendChild(seq);
        }

        const addSequenceLink = document.getElementById('addSequence');
        addSequenceLink.addEventListener('click', function (event) {
            event.preventDefault();
            const container = document.querySelector('.user-pomodoro-form-sequence');
            const sequenceInput = document.createElement('input');
            sequenceInput.type = 'text';
            sequenceInput.name = `sequence[]`; // Set unique name for each input field
            container.appendChild(sequenceInput); // Append input field to container
        });

        async function updateUserSequence(formData) {
            const url = `/update-user-sequences`;
            const options = {
                method: 'POST',
                body: formData
            };

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error:', error);
                return null;
            }
        }

        // Add event listener to "Update" link to send POST request to /update-user-sequences
        // const updateSequenceBtn = document.getElementById('update-sequence-btn');
        document.getElementById('update-sequence-btn').addEventListener('click', async function (event) {
            event.preventDefault();
            const formData = new FormData(document.getElementById('user-pomodoro-form'));
            const response = await updateUserSequence(formData);

            updateSequences();
            // Convert FormData to object
            // const sequences = { };
            // for (const [key, value] of formData.entries()) {
            //     sequences[key] = value.split(',').map(Number); // Convert string to array of numbers
            // }

            // console.log(sequences);

            // Send POST request to /update-user-sequences

        });
        // 
        // 
        // 

        function generatePomodoroSelectors() {
            const pomodoroSelectorContainer = document.querySelector('.container-pomodoro-selector');

            // Clear any existing pomodoro selector elements
            pomodoroSelectorContainer.innerHTML = '';

            // Loop through the number of sequences and generate radio buttons
            for (let i = 0; i < sequencesLength; i++) {
                const sequenceIndex = i;
                const pomodoroSelectorDiv = document.createElement('div');
                pomodoroSelectorDiv.classList.add('pomodoro-selector');
                pomodoroSelectorDiv.innerHTML = `
            <input type="radio" name="time_opt" id="${sequenceIndex}" data-option="${sequenceIndex}" value="${sequenceIndex + 1}">
                <label for="${sequenceIndex}">
                    <span class="material-symbols-outlined" id="clock-icon">pace</span>
                    ${sequenceIndex + 1}
                </label>
                `;
                // Sequence ${sequenceIndex + 1} - ${user_sequences[sequenceIndex].join('-')}

                // Add event listener to set the time sequence when a radio button is clicked
                const radioButton = pomodoroSelectorDiv.querySelector('input[type="radio"]');
                radioButton.addEventListener('click', function () {
                    const selectedOption = parseInt(this.dataset.option);
                    timeSequence = user_sequences[selectedOption];
                    timeDisplayMin.textContent = `${timeSequence[0].toString().padStart(2, '0')}`;
                    // timeDisplaySec.textContent = `${seconds.toString().padStart(2, '0')}`;
                    console.log('Selected time sequence:', timeSequence);
                });

                pomodoroSelectorContainer.appendChild(pomodoroSelectorDiv);
            }
            const firstRadioButton = pomodoroSelectorContainer.querySelector('input[type="radio"]');
            if (firstRadioButton) {
                firstRadioButton.checked = true;
                timeSequence = user_sequences[0]; // Set the time sequence to the first one
                timeDisplayMin.textContent = `${timeSequence[0].toString().padStart(2, '0')}`;
            }
        }

        // Call the function to generate pomodoro selectors when the page loads
        updateSequences();

        function updateTime() {
            const minutes = Math.floor(secondsLeft / 60);
            const seconds = secondsLeft % 60;
            timeDisplayMin.textContent = `${minutes.toString().padStart(2, '0')}`;
            timeDisplaySec.textContent = `${seconds.toString().padStart(2, '0')}`;
        }

        function addTimeToUser(variable) {
            variable = variable / 60;
            // Data to be sent in the request
            const data = { variable: variable };

            // Fetch POST request
            fetch('/add-time-to-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data) // Convert data to JSON format
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Response:', data);
                    // Handle response data
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }

        function startTimer() {
            startButton.disabled = true;
            stopButton.disabled = false;
            resetButton.disabled = false;
            let startTime = new Date().getTime();
            var currentTIme = timeSequence[sequenceIndex]*1;
            // sequenceIndex = 0; // Initialize index for the time sequence
            let endTime = startTime + (timeSequence[sequenceIndex] * 60 * 1000); // Use the first value in the sequence
            localStorage.setItem('endTime', endTime);
            timerInterval = setInterval(() => {
                const now = new Date().getTime();
                secondsLeft = Math.round((endTime - now) / 1000);
                updateTime();

                if (secondsLeft <= 0) {
                    const timerSound = document.getElementById('timer-sound');
                    timerSound.play();
                    console.log('timerSound played!');
                    addTimeToUser(currentTIme);
                }

                if (secondsLeft <= 0) {
                    clearInterval(timerInterval);
                    // Move to the next value in the time sequence
                    sequenceIndex++;
                    timeDisplayMin.textContent = `${timeSequence[sequenceIndex].toString().padStart(2, '0')}`;

                    // Check if we have reached the end of the sequence
                    if (sequenceIndex >= timeSequence.length) {
                        // Reset index to start from the beginning of the sequence
                        sequenceIndex = 0;
                    }
                    // Calculate endTime using the next value in the sequence
                    endTime = now + (timeSequence[sequenceIndex] * 1000);
                    localStorage.setItem('endTime', endTime);
                    startButton.disabled = false;
                    stopButton.disabled = true;
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            startButton.disabled = false;
            stopButton.disabled = true;
        }

        // function resetTimer() {
        //     clearInterval(timerInterval);
        //     isWorkTime = true;
        //     const endTime = startTime + (timeSequence[sequenceIndex] * 60 * 1000);
        //     sequenceIndex = 0;
        //     const now = new Date().getTime();
        //     secondsLeft = Math.round((endTime - now) / 1000);
        //     // secondsLeft = 1500; // Reset to 25 minutes work time
        //     updateTime();
        //     localStorage.removeItem('endTime');
        //     startButton.disabled = false;
        //     stopButton.disabled = true;
        // }

        function resetTimer() {
            clearInterval(timerInterval);
            isWorkTime = true;
            sequenceIndex = 0; // Reset the sequence index to 0
            const endTime = new Date().getTime() + (timeSequence[sequenceIndex] * 60 * 1000);
            const now = new Date().getTime();
            secondsLeft = Math.round((endTime - now) / 1000);
            updateTime();
            localStorage.removeItem('endTime');
            startButton.disabled = false;
            stopButton.disabled = true;
        }


        // Check if there's a saved end time in localStorage
        const savedEndTime = localStorage.getItem('endTime');
        if (savedEndTime) {
            const now = new Date().getTime();
            secondsLeft = Math.round((savedEndTime - now) / 1000);
            if (secondsLeft > 0) {
                startTimer();
            } else {
                localStorage.removeItem('endTime');
            }
        } else {
            secondsLeft = 1500; // Default to 25 minutes work time
        }

        startButton.addEventListener('click', startTimer);
        stopButton.addEventListener('click', stopTimer);
        resetButton.addEventListener('click', resetTimer);

        // 
        // Script for Friends Section
        // 
        async function checkUsername(username) {
            const response = await fetch('/check-username', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `username=${username}`
            });
            const data = await response.json();
            return data.message === 'Username available';
        }

        async function checkStatus(username) {
            const response = await fetch('/add-friend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `friend-username=${username}`
            });
            const data = await response.json();
            return data.message;
        }

        document.querySelector('#add-friend-btn').addEventListener('click', async function (e) {
            e.preventDefault();
            const username = document.querySelector('#friend-username').value;
            // console.log(username)
            // const user_id = '{{ user._id }}';
            let alertbox = document.querySelector('#alert-friend-form');
            if (!username) {
                alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--cardinal);">error</span>Please Enter Name'
                alertbox.style.display = 'flex';

                setTimeout(function () {
                    alertbox.style.display = 'none';
                }, 5000)
            }
            const isFriendPresent = await checkUsername(username);

            if (isFriendPresent) {
                response = await checkStatus(username);
                // console.log(response);
                if (response === 'Friend already in friends list') {
                    alertbox.style.display = 'flex';
                    // alertbox.style.backgroundColor = 'var(--feather-green)';
                    alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">sentiment_very_satisfied</span>You\'re Already Friends</span>'
                    setTimeout(function () {
                        alertbox.style.display = 'none';
                    }, 3000)
                } else if (response === 'Friend Request Sent!') {
                    alertbox.style.display = 'flex';
                    // alertbox.style.backgroundColor = 'var(--feather-green)';
                    alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">done</span>Friend Request Sent!</span>'
                    setTimeout(function () {
                        alertbox.style.display = 'none';
                    }, 3000)
                } else {
                    alertbox.style.display = 'flex';
                    alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">error</span>Failed to send request!</span>'
                    setTimeout(function () {
                        alertbox.style.display = 'none';
                    }, 3000)
                }
            } else {
                alertbox.style.display = 'flex';
                alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--cardinal);">error</span>Check Friend\s Name'
                // alertbox.textContent = "Check Friend's Name";
                setTimeout(function () {
                    alertbox.style.display = 'none';
                }, 3000)
            }
        });

        // 
        // Script for Handling Friend Requests
        // 
        async function acceptFriendRequest(requestId) {
            const response = await fetch(`/accept-friend-request/${requestId}`, {
                method: 'POST'
            });
            const data = await response.json();
            if (response.status === 200) {
                updateNotifications();
                updateStats();
                // Handle success, maybe hide the notification or update UI
                // console.log(data.message);
            } else {
                // Handle error, maybe show an error message
                console.error(data.message);
            }
        }

        async function closeNotification(notificationId, buttonElement) {
            const response = await fetch(`/close-notification/${notificationId}`, {
                method: 'POST'
            });
            const data = await response.json();
            if (response.status === 200) {
                const notificationElement = buttonElement.closest('.notification');
                // notificationElement.style.display = 'none';
                // updateNotifications();
                notificationElement.style.transition = 'opacity 0.3s ease-out, height 0.3s ease-out';
                // Set opacity to 0 and height to 0 to gradually hide the element
                notificationElement.style.opacity = '0';
                notificationElement.style.height = '0';
                // After the transition duration, remove the notification element from the DOM
                setTimeout(() => {
                    notificationElement.remove();
                }, 300);
                // Handle success, maybe hide the notification or update UI
                // console.log(data.message);
            } else {
                // Handle error, maybe show an error message
                console.error(data.message);
            }
        }

        async function rejectFriendRequest(requestId) {
            const response = await fetch(`/reject-friend-request/${requestId}`, {
                method: 'POST'
            });
            const data = await response.json();
            if (response.status === 200) {
                // Handle success, maybe hide the notification or update UI
                // console.log(data.message);
                // Remove the notification from the UI
                const notification = document.querySelector(`.notification[data-request-id="${requestId}"]`);
                // notification.style.display = 'none';
                updateNotifications();
            } else {
                // Handle error, maybe show an error message
                console.error(data.message);
            }
        }

        async function removeFriend(friendUsername) {
            const formData = new FormData();
            formData.append('friend_username', friendUsername);

            fetch('/remove-friend', {
                method: 'POST',
                headers: {
                    // No need to specify 'Content-Type' for FormData
                },
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        updateStats();
                        // Optionally update UI
                    } else {
                        console.error('Failed to send removal request');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // 
        // Script for handling daily tasks
        // 
        // document.getElementById('addFields').addEventListener('click', function (e) {
        //     e.preventDefault();
        //     var taskFields = document.getElementById('taskFields');
        //     var newTaskField = document.createElement('div');
        //     newTaskField.innerHTML = `
        //                 <input type="text" class="task" name="task[]" placeholder="Question">
        //                 <input type="radio" value="Tomohawh">TOTO</input>
        //                 <input type="radio" value="Mahaw">MAHAW</input>

        //             `;
        //     taskFields.appendChild(newTaskField);
        // });

        async function getUserStats() {
            try {
                // const requestData = {
                //     userId: userId,
                //     otherVariable: otherVariable
                // };

                // const userId = '{{ user._id }}';
                // const requestData = { userId: userId };
                // console.log(userId);
                const response = await fetch('/getUserStats', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                    // body: JSON.stringify(requestData)
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch user stats');
                }
                const userStats = await response.json();
                // Update the UI with the user stats
                return userStats
            } catch (error) {
                console.error('Error fetching user stats:', error);
            }
        }

        async function getUser() {
            try {
                // const requestData = {
                //     userId: userId,
                //     otherVariable: otherVariable
                // };

                const userId = '{{ user._id }}';
                const requestData = { userId: userId };
                // console.log(userId);
                const response = await fetch('/getUser/{{ user._id }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch user object');
                }
                const user = await response.json();
                // console.log(response.body)
                // document.getElementById('homo').textContent = "Om" + response.body;
                // Update the UI with the user stats
                return user
            } catch (error) {
                console.error('Error fetching user stats:', error);
            }
        }

        async function getFriendRequests(receiverId) {
            try {
                const response = await fetch('/get-reqs-for-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ receiver_id: receiverId })
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch friend requests');
                }
                const friendRequests = await response.json();
                return friendRequests;
            } catch (error) {
                console.error('Error fetching friend requests:', error);
            }
        }

        async function getNotifications(receiverId) {
            try {
                const response = await fetch('/get-noti-for-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ receiver_id: receiverId })
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch friend requests');
                }
                const userNotifications = await response.json();
                return userNotifications;
            } catch (error) {
                console.error('Error fetching friend requests:', error);
            }
        }
        async function updateNotifications() {
            let user = await getUser();
            // Updating Notifications
            const friendRequests = await getFriendRequests(user._id);
            // console.log(friendRequests);
            const notificationsContainer = document.querySelector('.notification-social-reqs');
            notificationsContainer.innerHTML = ''; // Clear previous notifications
            friendRequests.forEach(request => {
                const notificationElement = document.createElement('div');
                notificationElement.classList.add('notification');
                notificationElement.innerHTML = `
                <div class="notification-from">${request.sender}
                    <div class="notification-type">${request.type}</div>
                    </div>
                    <div class="notification-action" id="notification-actions">
                        <button class="notification-action-btn accept" onclick="acceptFriendRequest('${request._id}')"><span class="material-symbols-outlined">check</span></button>
                        <button class="notification-action-btn reject" onclick="rejectFriendRequest('${request._id}')"><span class="material-symbols-outlined">close</span></button>
                        </div>`;
                notificationsContainer.appendChild(notificationElement);
            });

            const userNotifications = await getNotifications(user._id);
            // console.log(userNotifications);

            userNotifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                // console.log(notification);
                notificationElement.classList.add('notification');
                notificationElement.innerHTML = `
            <div class="notification-from">${notification.sender}
                <div class="notification-type">${notification.type}</div>
                </div>
                <div class="notification-action" id="notification-actions">
                    <button class="notification-action-btn close" onclick="closeNotification('${notification._id}',this)"><span class="material-symbols-outlined">close</span></button>
            </div>`;
                notificationsContainer.appendChild(notificationElement);
            });
        }

        async function updateStats() {
            let userStats = getUserStats();

            let user = await getUser();

            userStats.then((stats) => {
                document.getElementById('streaks-stat').textContent = stats[0].streaks;
                document.getElementById('gems-stat').textContent = stats[0].gems;
                document.getElementById('hearts-stat').textContent = stats[0].hearts;
                // console.log(stats[0].gems);

            })


        };



        async function generateExFriendsList(targetContainer) {
            try {
                const user = await getUser();
                const container = document.querySelector(targetContainer);
                const manager = document.querySelector(".group-handle-con");
                container.innerHTML = '';
                const response = await fetch('/get-grp-members', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ group_id: manager.dataset.grpI })
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch members');
                }
                const members = await response.json();

                user.friends.forEach((friend) => {
                    // Check if the friend is not a member of the group
                    if (!members.includes(friend)) {
                        const friendElement = document.createElement('div');
                        friendElement.classList.add('grp-exmember-item');
                        friendElement.innerHTML = `
                    <input type="checkbox" name="" id="ex-friend-${friend}" data-friend="${friend}">
                    <label for="ex-friend-${friend}">${friend}</label>
                `;
                        container.appendChild(friendElement);
                    }
                });

                const demoElement = document.createElement('span');
                demoElement.classList.add('less-imp-text');
                demoElement.style.textAlign = 'center';
                demoElement.textContent = 'End Of List';
                container.appendChild(demoElement);
                console.log("I was called");
            } catch (error) {
                console.error('An error occurred:', error);
                // Handle error or display a message to the user
            }
        }

        function generateFriendsList(targetContainer) {
            getUser().then((user) => {
                const container = document.querySelector(targetContainer);
                container.innerHTML = '';


                user.friends.forEach((friend) => {
                    const friendElement = document.createElement('div');
                    friendElement.classList.add('grp-member-item');
                    friendElement.innerHTML = `
                  <input type="checkbox" name="" id="friend-${friend}" data-friend="${friend}">
                    <label for="friend-${friend}">${friend}</label>
                `;
                    container.appendChild(friendElement);
                });
                const demoElement = document.createElement('span');
                demoElement.classList.add('less-imp-text');
                demoElement.style.textAlign = 'center';
                demoElement.textContent = 'End Of List';
                container.appendChild(demoElement);
            });
        }

        const memberSelects = document.querySelectorAll('.member-select input[type="checkbox"]');

        memberSelects.forEach(memberSelect => {
            memberSelect.addEventListener('change', () => {
                const memberSelectElement = memberSelect.closest('.member-select');
                if (memberSelect.checked) {
                    memberSelectElement.classList.add('checked');
                } else {
                    memberSelectElement.classList.remove('checked');
                }
            });
        });

        async function checkGroupname(groupname) {
            const response = await fetch('/check-groupname-availability', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `groupname=${groupname}`
            });
            const data = await response.json();
            return data.message === 'Groupname available';
        }

        async function createGroup(formData) {
            try {
                const response = await fetch('/create-group', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) {
                    throw new Error('Failed to create group');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error creating group:', error);
                return { message: 'Error creating group' };
            }
        }

        async function addMembers(formData) {
            try {
                const response = await fetch('/add-member-to-group', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) {
                    throw new Error('Failed to add members!');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error adding members', error);
                return { message: 'Error adding members' };
            }
        }

        document.getElementById('create-group-btn').addEventListener('click', async function (event) {
            event.preventDefault();
            const groupNameInput = document.getElementById('group-name');
            const groupName = groupNameInput.value.trim();
            alertbox = document.getElementById('alert-group-form');
            if (groupName == "") {
                alertbox.style.display = 'flex';
                // alertbox.style.backgroundColor = 'var(--feather-green)';
                alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">sentiment_very_satisfied</span>You\'re Enter a Group Name</span>'
                setTimeout(function () {
                    alertbox.style.display = 'none';
                }, 3000)
            }
            const validatedGroupName = await checkGroupname(groupName);

            if (validatedGroupName) {
                const selectedFriends = [];
                const checkboxes = document.querySelectorAll('.grp-member-item input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedFriends.push(checkbox.dataset.friend);
                    }
                });
                if (selectedFriends.length > 0) {
                    const formData = new FormData();
                    formData.append('groupname', groupName);
                    formData.append('selectedFriends', JSON.stringify(selectedFriends));
                    const response = await createGroup(formData);

                    alertbox.style.display = 'flex';
                    // alertbox.style.backgroundColor = 'var(--feather-green)';
                    alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">sentiment_very_satisfied</span>Group Succesfully Created</span>'
                    setTimeout(function () {
                        alertbox.style.display = 'none';
                    }, 3000)
                } else {
                    alertbox.style.display = 'flex';
                    // alertbox.style.backgroundColor = 'var(--feather-green)';
                    alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">sentiment_very_satisfied</span>Please select atleast one member</span>'
                    setTimeout(function () {
                        alertbox.style.display = 'none';
                    }, 3000)
                }
            } else {
                var alert = document.getElementById('alert-group-form');

            }
        });

        document.getElementById('add-btn-grp').addEventListener('click', async function (event) {
            event.preventDefault();
            const groupManager = document.querySelector('.group-handle-con');
            const groupId = groupManager.dataset.grpI;
            const selectedFriends = [];
            const checkboxes = document.querySelectorAll('.grp-exmember-item input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedFriends.push(checkbox.dataset.friend);
                }
            });
            if (selectedFriends.length > 0) {
                const formData = new FormData();
                // formData.append('groupname', groupName);
                formData.append('groupId', groupId);
                formData.append('selectedFriends', JSON.stringify(selectedFriends));
                const response = await addMembers(formData);
                await generateExFriendsList('.add-member-list');
                await generateManagerList(groupManager.dataset.grpN, groupManager.dataset.grpI, groupManager.dataset.isUserAdmin);
                // alertbox.style.display = 'flex';
                // // alertbox.style.backgroundColor = 'var(--feather-green)';
                // alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">sentiment_very_satisfied</span>Group Succesfully Created</span>'
                // setTimeout(function () {
                //     alertbox.style.display = 'none';
                // }, 3000)
            } else {
                // alertbox.style.display = 'flex';
                // // alertbox.style.backgroundColor = 'var(--feather-green)';
                // alertbox.innerHTML = '<span class="material-symbols-outlined" style="font-size: 24px; color: var(--feather-green);">sentiment_very_satisfied</span>Please select atleast one member</span>'
                // setTimeout(function () {
                //     alertbox.style.display = 'none';
                // }, 3000)
            }
        });

        async function getUserGroups(query = null) {
            try {
                const formData = new FormData();
                formData.append('query', query);

                const response = await fetch('/get-user-groups/2', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user groups');
                }

                const groups = await response.json();
                return groups;
            } catch (error) {
                console.error('Error fetching user groups:', error);
                return null;
            }
        }


        async function generateUserGroupsList(query = null) {
            var colorCodes = ["#70d6ff", "#ff70a6", "#ff9770", "#ffd670", "#e9ff70", "#9381ff", "#7bf1a8"];

            function getRandomColor() {
                return colorCodes[Math.floor(Math.random() * colorCodes.length)];
            }

            const groups = await getUserGroups(query);

            const container = document.querySelector('.group-list-container');
            container.textContent = "";
            // console.log(groups.length);
            var currUser = groups[0];
            currentUser = groups[0];
            console.log(groups);
            groups[1].forEach(group => {
                // Create div element for each group

                var link = document.createElement("a");
                link.setAttribute("class", "grp-lst-item");
                link.setAttribute("href", "#");
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    openGroupView(group, currUser);
                });

                function generateLogoText(text) {
                    // Split the input text into words
                    const words = text.trim().split(/\s+/);

                    // If there's only one word, use its first letter
                    if (words.length === 1) {
                        return words[0].charAt(0).toUpperCase();
                    }

                    // If there are multiple words, use the first letters of the first two words
                    return words[0].charAt(0).toUpperCase() + words[1].charAt(0).toUpperCase();
                }

                var logoDiv = document.createElement("div");
                logoDiv.setAttribute("class", "grp-logo");
                logoDiv.textContent = generateLogoText(group.name);
                logoDiv.style.backgroundColor = getRandomColor();

                var descDiv = document.createElement("div");
                descDiv.setAttribute("class", "grp-desc");

                var nameSpan = document.createElement("span");
                nameSpan.setAttribute("class", "grp-name");
                nameSpan.textContent = group.name;

                var adminSpan = document.createElement("span");
                adminSpan.setAttribute("class", "grp-admin");
                adminSpan.textContent = "Created By " + group.group_leader;

                descDiv.appendChild(nameSpan);
                descDiv.appendChild(adminSpan);

                link.appendChild(logoDiv);
                link.appendChild(descDiv);

                container.appendChild(link);

                // const groupDiv = document.createElement('div');
                // groupDiv.classList.add('groups-list-item');

                // // Create span element for group name
                // const groupNameSpan = document.createElement('span');
                // groupNameSpan.classList.add('simple-text');
                // groupNameSpan.textContent = group.name;
                // groupDiv.appendChild(groupNameSpan);

                // // Create link element for group info
                // const infoLink = document.createElement('a');
                // infoLink.href = '#'; // Update href attribute as needed
                // infoLink.classList.add('ui-button');
                // infoLink.addEventListener('click', function (event) {
                //     event.preventDefault();
                //     openGroupView(group);
                // });

                // // Create span element for info icon
                // const infoIconSpan = document.createElement('span');
                // infoIconSpan.classList.add('material-symbols-rounded');
                // infoIconSpan.textContent = 'info';
                // infoLink.appendChild(infoIconSpan);

                // // Append info link to group div
                // groupDiv.appendChild(infoLink);

                // // Append group div to container
                // container.appendChild(groupDiv);
            });
            console.log("Function Called and Execution Completed");
        }

        function openGroupView(group, currUser) {

            // alert("Button Clicked"+ group.name);
            const crtTaskCon = document.querySelector(".group-tsk-crt-con");
            const crtTaskBtn = document.getElementById("create-grp-task-btn");
            const groupContainer = document.querySelector(".selected-group-info");
            const taskListContainer = document.querySelector(".group-task-list");
            const emptyHandler = document.querySelector("#group-empty-state");
            const groupName = document.getElementById("grp-name");
            const groupMembers = document.getElementById("grp-members");
            const groupManager = document.querySelector('.group-handle-con');
            const isUserAdmin = currUser == group.group_leader ? true : false;

            groupManager.dataset.grpN = group.name;
            groupManager.dataset.grpI = group._id;
            // groupManager.dataset.grpN = group.name;
            groupManager.dataset.isUserAdmin = isUserAdmin;
            groupManager.dataset.members = group.members;



            if (isUserAdmin) {
                crtTaskCon.style.display = 'flex';
                crtTaskBtn.dataset.grpId = group._id;
                crtTaskBtn.dataset.grpName = group.name;
                crtTaskBtn.dataset.isUsrAdmin = isUserAdmin;
            } else {
                crtTaskCon.style.display = 'none';
            }

            groupName.textContent = group.name;
            groupMembers.textContent = group.members.length + " members";
            groupContainer.style.display = "flex";
            emptyHandler.style.display = "none";
            const groupId = group._id;
            console.log(groupId, isUserAdmin);
            // generateGroupTasks(groupId, isUserAdmin);
            generateGrpTsk(groupId, isUserAdmin);
            // console.log("Hello this step reached!!!!!!!!")

        }

        async function deleteTask(taskId) {
            try {
                const response = await fetch('/delete-task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ task_id: taskId })
                });
                const data = await response.json();
                if (data.success) {
                    // Reload group tasks after deletion
                    const groupId = document.getElementById('create-group-task-btn').dataset.groupId;
                    generateGroupTasks(groupId);
                } else {
                    console.error('Error deleting task:', data.error);
                }
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }

        async function deleteGroupTask(taskId, groupId, isUserAdmin) {
            try {
                const response = await fetch('/delete-group-task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ task_id: taskId })
                });
                const data = await response.json();
                if (data.success) {
                    // Reload group tasks after deletion
                    // const groupId = document.getElementById('create-group-task-btn').dataset.groupId;
                    // console.log(groupId, isUserAdmin);
                    generateGrpTsk(groupId, isUserAdmin);

                } else {
                    console.error('Error deleting task:', data.error);
                }
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }

        async function deleteGroup(groupId, isUserAdmin) {
            try {
                const response = await fetch('/delete-group', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ groupId: groupId })
                });
                const data = await response.json();
                if (data.success) {
                    // Reload group tasks after deletion
                    // const groupId = document.getElementById('create-group-task-btn').dataset.groupId;
                    // console.log(groupId, isUserAdmin);
                    // generateGrpTsk(groupId, isUserAdmin);
                    return true;
                } else {
                    console.error('Error deleting task:', data.error);
                    return false;
                }
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }


        // var createTaskBtn = document.getElementById('create-group-task-btn');

        // const form = document.querySelector('.view-tasks-create');
        // form.addEventListener('submit', async function (event) {
        //     event.preventDefault();

        //     // Extract form data
        //     const groupId = document.getElementById('create-group-task-btn').dataset.groupId;
        //     const groupName = document.getElementById('create-group-task-btn').dataset.groupName;
        //     const taskName = document.getElementById('task-name').value;
        //     const taskCompletionDate = document.getElementById('date-task-completion').value;
        //     console.log(taskName, taskCompletionDate);

        //     try {
        //         // Call the async function to handle form submission
        //         const response = await createGroupTask(groupId, groupName, taskName, taskCompletionDate);
        //         generateGroupTasks(groupId);
        //         // Handle successful response from Flask route
        //         // Optionally update UI based on response data
        //     } catch (error) {
        //         // Handle errors
        //         console.error('Error:', error);
        //     }
        // });

        async function createGroupTask(groupId, groupName, taskName, taskCompletionDate) {
            try {
                // Send form data to Flask route asynchronously using fetch API
                var response = await fetch('/create-group-task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        'group_Id': groupId,
                        'group_name': groupName,
                        'task_name': taskName,
                        'task_completion_date': taskCompletionDate
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create task');
                }

                // Return the JSON response
                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        async function fillProfile() {
            const user = await getUser();
            const u_name = document.getElementById('profile-name');
            const u_email = document.getElementById('profile-email');
            const u_social = document.querySelector('.info-social');
            const u_streak = document.querySelector('#u-streak');
            const u_xp = document.querySelector('#u-xp');
            const u_hearts = document.querySelector('#u-hearts');
            const u_top10 = document.querySelector('#u-top10');
            const join_date = document.querySelector('#profile-join-date');


            u_name.textContent = user.username;
            u_email.textContent = user.email;
            u_social.textContent = `You've ${user.friends.length} friends and member in ${user.groups.length} groups.`;

            const joiningDate = user.joinging_date;
            const date = new Date(joiningDate);

            // Assuming user's locale is stored in user.locale
            const locale = user.locale || 'en-US'; // Default to 'en-US' if locale is not available
            const options = { day: '2-digit', month: 'long', year: 'numeric' };

            // Format the date using the user's locale
            const formattedDate = date.toLocaleDateString(locale, options);

            // Update the join_date element with the formatted date
            join_date.textContent = formattedDate;



        }

        document.addEventListener('DOMContentLoaded', function () {

            updateStats();
            fillProfile();
            updateNotifications();
            generateFriendsList('.group-member-add-list');
            // generateFriendsList('.friends-list');
            generateUserDailyTasksToShow();
            generateUserGroupsList("");
            generateUserFriendsList("");
            generateUserDailyTasks();
            setInterval(updateNotifications, 5000);
            setInterval(updateStats, 5000);
        });



    </script>
    <script>
        function calculateTaskCompletionPercentage(taskObject) {
            // Initialize variables for total members and complete members
            var totalMembers = Object.keys(taskObject.members_status).length;
            var completeMembers = 0;

            // Loop through the members_status object and count the complete members
            for (var member in taskObject.members_status) {
                if (taskObject.members_status[member] === 'complete') {
                    completeMembers++;
                }
            }

            // Calculate the percentage of task completion
            var completionPercentage = (completeMembers / totalMembers) * 100;

            // Round the percentage to two decimal places
            completionPercentage = Math.round(completionPercentage * 100) / 100;
            completionPercentage = completionPercentage.toFixed(0)
            return completionPercentage;
        }

        async function markMyTaskComplete(taskId, mode) {
            try {
                const response = await fetch('/mark-my-task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ task_id: taskId, mode: mode, user: currentUser })
                });
                const data = await response.json();
                if (data.success) {
                    // Reload group tasks after deletion
                    // const groupId = document.getElementById('create-group-task-btn').dataset.groupId;
                    // generateGrpTsk(groupId);
                } else {
                    console.error('Error deleting task:', data.error);
                }
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }
        async function deleteTask(taskId) {
            try {
                const response = await fetch('/delete-task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ task_id: taskId })
                });
                const data = await response.json();
                if (data.success) {
                    // Reload group tasks after deletion
                    const groupId = document.getElementById('create-group-task-btn').dataset.groupId;
                    generateGroupTasks(groupId);
                } else {
                    console.error('Error deleting task:', data.error);
                }
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }

        async function generateGrpTsk(groupId, isUserAdmin) {
            try {
                const response = await fetch('/get-group-tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ group_id: groupId })
                });
                const tasks = await response.json();
                console.log(tasks);
                const groupTasksContainer = document.querySelector('.group-task-list');
                groupTasksContainer.innerHTML = ''; // Clear previous content

                if (tasks[1].length > 0) {
                    tasks[1].forEach(task => {
                        console.log("Generating Tasksksskssss");
                        // const taskRow = document.createElement('div');
                        // taskRow.classList.add('tasks-show-table-row');

                        const createdDate = new Date(task.creation_date);
                        const completionDate = new Date(task.task_completion_date);
                        const remainingDays = Math.ceil((completionDate - new Date()) / (1000 * 60 * 60 * 24));
                        const elapsed = new Date() > new Date(completionDate);
                        var groupTaskItem = document.createElement('div');
                        groupTaskItem.className = 'group-task-item';

                        var groupTaskItemMain = document.createElement('div');
                        groupTaskItemMain.className = 'group-task-item-main';

                        // Create the span element for task name
                        var taskNameSpan = document.createElement('span');
                        taskNameSpan.className = 'grp-task-name';
                        var taskName = document.createElement('span');
                        taskName.className = 'grp-tsk-name';
                        taskName.textContent = task.task_name;
                        // taskElapse.textContent = `${remainingDays} days left!`;
                        taskNameSpan.appendChild(taskName);
                        // taskNameSpan.appendChild(taskElapse);

                        var grpMostActions = document.createElement('div');
                        grpMostActions.className = 'grp-most-actions';

                        var taskElapse = document.createElement('span');
                        taskElapse.className = 'grp-task-elapse less-imp-text';
                        taskElapse.textContent = elapsed ? `Elapsed ${Math.abs(remainingDays)} days ago!` : `${remainingDays} days left!`;
                        var taskStatusSpan = document.createElement('span');
                        taskStatusSpan.className = 'grp-task-status';
                        var progressSymbol = document.createElement('span');
                        progressSymbol.className = 'material-symbols-outlined';
                        progressSymbol.style.fontSize = '24px';
                        progressSymbol.textContent = 'progress_activity';
                        taskStatusSpan.appendChild(progressSymbol);
                        var percentageText = document.createElement('span');
                        percentageText.textContent = calculateTaskCompletionPercentage(task) + '%';

                        taskStatusSpan.appendChild(progressSymbol);
                        taskStatusSpan.appendChild(percentageText);

                        var isTaskComplete = task.members_status[currentUser] == 'complete';
                        var markAsCompleteBtn = document.createElement('button');
                        markAsCompleteBtn.className = 'mark-as-complete ui-button-2';
                        markAsCompleteBtn.setAttribute('task._id', task._id); // Adding task._id attribute
                        var doneAllSymbol = document.createElement('span');
                        doneAllSymbol.className = 'material-symbols-outlined';
                        doneAllSymbol.style.fontSize = '24px';
                        doneAllSymbol.textContent = 'done_all';
                        if (isTaskComplete) {
                            markAsCompleteBtn.style.backgroundColor = 'var(--feather-green)';
                            markAsCompleteBtn.style.color = 'var(--snow)';

                        }
                        markAsCompleteBtn.appendChild(doneAllSymbol);
                        // Add click event listener to the markAsCompleteBtn button
                        markAsCompleteBtn.addEventListener('click', async function () {
                            // Get the task ID from the attribute
                            var taskId = markAsCompleteBtn.getAttribute('task._id');
                            var mode = isTaskComplete ? 'pending' : 'complete';

                            // Call markMyTaskComplete function with taskId as argument
                            console.log("Making taks" + mode);
                            await markMyTaskComplete(taskId, mode);

                            // alert("Click it, changin colour");

                            // Change background color based on task completion status
                            markAsCompleteBtn.style.backgroundColor = isTaskComplete ? 'var(--swan)' : 'var(--feather-green)';

                            // Regenerate the group task list
                            generateGrpTsk(groupId, isUserAdmin);
                        });

                        if (isUserAdmin) {
                            var delTskBtn = document.createElement('button');
                            delTskBtn.className = 'del-grp-tsk ui-button-2';
                            var deleteSymbol = document.createElement('span');
                            deleteSymbol.className = 'material-symbols-outlined';
                            delTskBtn.addEventListener('click', () => deleteGroupTask(task._id, groupId, isUserAdmin));
                            deleteSymbol.style.fontSize = '24px';
                            deleteSymbol.textContent = 'delete';
                            delTskBtn.appendChild(deleteSymbol);
                        }

                        var taskDetailsBtn = document.createElement('button');
                        taskDetailsBtn.className = 'task-det-handle ui-button-2';
                        var expandMoreSymbol = document.createElement('span');
                        expandMoreSymbol.className = 'material-symbols-outlined';
                        expandMoreSymbol.style.fontSize = '24px';
                        expandMoreSymbol.textContent = 'expand_more';
                        taskDetailsBtn.appendChild(expandMoreSymbol);
                        taskDetailsBtn.addEventListener('click', function (event) {
                            // Get the nearest parent container of the clicked button
                            var taskItem = event.target.closest('.group-task-item');

                            // Find the task-more-info div within the parent container
                            var taskMoreInfo = taskItem.querySelector('.task-more-info');

                            // Check if task-more-info is already visible
                            var isExpanded = taskMoreInfo.style.display !== 'none';

                            // Collapse all other task details
                            var allTaskDetails = document.querySelectorAll('.task-more-info');
                            allTaskDetails.forEach(function (detail) {
                                if (detail !== taskMoreInfo) {
                                    detail.style.display = 'none';
                                }
                            });

                            // Toggle the visibility of the clicked task details
                            taskMoreInfo.style.display = isExpanded ? 'none' : 'flex';
                            // groupTaskItem.style.border = isExpanded ? 'none' : 'flex';
                            // Change the button span text content to "expand_less" if expanded, or "expand_more" if collapsed
                            var buttonSpan = this.querySelector('.material-symbols-outlined');
                            buttonSpan.textContent = isExpanded ? 'expand_more' : 'expand_less';
                        });



                        // Append all child elements to the main container
                        groupTaskItemMain.appendChild(taskNameSpan);
                        grpMostActions.appendChild(taskElapse);
                        grpMostActions.appendChild(taskStatusSpan);
                        grpMostActions.appendChild(taskStatusSpan);
                        grpMostActions.appendChild(markAsCompleteBtn);
                        if (isUserAdmin) {
                            grpMostActions.appendChild(delTskBtn);
                        }
                        grpMostActions.appendChild(taskDetailsBtn);
                        groupTaskItemMain.appendChild(grpMostActions);

                        var groupTaskItemInfo = document.createElement('div');
                        groupTaskItemInfo.className = 'group-task-item-info';

                        // Create the div for task more information
                        var taskMoreInfoDiv = document.createElement('div');
                        taskMoreInfoDiv.className = 'task-more-info info-popup';

                        // Create the div for task member status
                        var taskMemberStatusDiv = document.createElement('div');
                        taskMemberStatusDiv.className = 'task-member-status';

                        var memberLength = Object.keys(task.members_status).length;
                        console.log(memberLength);
                        for (const [key, value] of Object.entries(task.members_status)) {
                            var taskMemberDiv = document.createElement('div');
                            taskMemberDiv.className = 'task-member';
                            var taskMemberNameSpan = document.createElement('span');
                            taskMemberNameSpan.className = 'task-member-name';
                            taskMemberNameSpan.textContent = key;
                            var doneAllSymbolForMember = document.createElement('span');
                            doneAllSymbolForMember.className = 'material-symbols-outlined';
                            doneAllSymbolForMember.style.fontSize = '24px';
                            if (value == 'pending') {
                                doneAllSymbolForMember.textContent = 'error';
                                doneAllSymbolForMember.style.color = 'var(--cardinal)';
                            } else {
                                doneAllSymbolForMember.textContent = 'done_all';
                            }
                            taskMemberDiv.appendChild(taskMemberNameSpan);
                            taskMemberDiv.appendChild(doneAllSymbolForMember);
                            taskMemberStatusDiv.appendChild(taskMemberDiv);
                        }

                        // for (var i = 0; i < memberLength; i++) {
                        //     var taskMemberDiv = document.createElement('div');
                        //     taskMemberDiv.className = 'task-member';
                        //     var taskMemberNameSpan = document.createElement('span');
                        //     taskMemberNameSpan.className = 'task-member-name';
                        //     taskMemberNameSpan.textContent = 'John Doe';
                        //     var doneAllSymbolForMember = document.createElement('span');
                        //     doneAllSymbolForMember.className = 'material-symbols-outlined';
                        //     doneAllSymbolForMember.style.fontSize = '24px';
                        //     doneAllSymbolForMember.textContent = 'done_all';
                        //     taskMemberDiv.appendChild(taskMemberNameSpan);
                        //     taskMemberDiv.appendChild(doneAllSymbolForMember);
                        //     taskMemberStatusDiv.appendChild(taskMemberDiv);
                        // }

                        var taskCalendarDiv = document.createElement('div');
                        taskCalendarDiv.className = 'task-calendar';
                        var createDateSpan = document.createElement('span');
                        createDateSpan.className = 'create-date';
                        createDateSpan.textContent = `${createdDate.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}`;
                        var widthSymbol = document.createElement('span');
                        widthSymbol.className = 'material-symbols-outlined';
                        widthSymbol.style.fontSize = '18px';
                        widthSymbol.textContent = 'width';
                        var completeDateSpan = document.createElement('span');
                        completeDateSpan.className = 'complete-date';
                        completeDateSpan.textContent = `${completionDate.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}`;
                        taskCalendarDiv.appendChild(createDateSpan);
                        taskCalendarDiv.appendChild(widthSymbol);
                        taskCalendarDiv.appendChild(completeDateSpan);

                        taskMoreInfoDiv.appendChild(taskMemberStatusDiv);
                        taskMoreInfoDiv.appendChild(taskCalendarDiv);

                        groupTaskItem.appendChild(groupTaskItemMain);
                        groupTaskItem.appendChild(groupTaskItemInfo);
                        groupTaskItemInfo.appendChild(taskMoreInfoDiv);

                        const container = document.querySelector('.group-task-list');
                        container.appendChild(groupTaskItem);
                        // Idhar se purana

                        // const taskInfo = document.createElement('div');
                        // taskInfo.classList.add('task-table-info');
                        // taskInfo.textContent = task.task_name; // Adjust to match your task object property

                        // const taskInfoDate = document.createElement('div');
                        // taskInfoDate.classList.add('task-info-date');


                        // taskInfoDate.innerHTML = `
                        // <span class="created_at">${createdDate.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}</span>
                        // <span class="days_remaining">Remaining Days ${remainingDays}</span>
                        // <span class="completion_at"></span>`;
                        // taskInfo.appendChild(taskInfoDate);

                        // const taskActions = document.createElement('div');
                        // taskActions.classList.add('task-table-actions');
                        // const deleteButton = document.createElement('a');
                        // deleteButton.classList.add('ui-button');
                        // deleteButton.style.backgroundColor = 'var(--cardinal)';
                        // deleteButton.innerHTML = '<span class="material-symbols-rounded">delete</span>';
                        // deleteButton.addEventListener('click', () => deleteGroupTask(task._id));
                        // taskActions.appendChild(deleteButton);

                        // taskRow.appendChild(taskInfo);
                        // taskRow.appendChild(taskActions);

                        // groupTasksContainer.appendChild(taskRow);

                    });
                    document.querySelectorAll('.task-more-info').forEach(function (taskMoreInfo) {
                        taskMoreInfo.style.display = 'none';
                    });
                    const spn = document.createElement('span');
                    spn.classList.add('less-imp-text');
                    spn.innerText = "End of tasks";
                    spn.style.textAlign = "center";
                    groupTasksContainer.appendChild(spn);

                } else {
                    console.log("No tasks found");
                    const spn = document.createElement('span');
                    spn.classList.add('less-imp-text');
                    spn.innerText = "No tasks in this group yet.";
                    // spn.style.textAlign = "center";
                    // spn.style.width = "100%";
                    // spn.style.backgroundColor = "red";
                    groupTasksContainer.appendChild(spn);

                }
            } catch (error) {
                console.error('Error fetching tasks:', error);
            }
        }

        async function getUserFriends(query = null) {
            try {
                const formData = new FormData();
                formData.append('query', query);

                const response = await fetch('/get-user-friends/2', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user groups');
                }

                const groups = await response.json();
                return groups;
            } catch (error) {
                console.error('Error fetching user groups:', error);
                return null;
            }
        }

        async function generateUserFriendsList(query = null) {
            var colorCodes = ["#70d6ff", "#ff70a6", "#ff9770", "#ffd670", "#e9ff70", "#9381ff", "#7bf1a8"];

            function getRandomColor() {
                return colorCodes[Math.floor(Math.random() * colorCodes.length)];
            }

            const friends = await getUserFriends(query);

            const container = document.querySelector('.friend-list-container');
            container.innerHTML = "";
            // container.textContent = "";
            // console.log(groups.length);
            // var currUser = groups[0];
            // currentUser = groups[0];
            console.log(friends + "This are my Friends");
            function generateLogoText(text) {
                // Split the input text into words
                const words = text.trim().split(/\s+/);

                // If there's only one word, use its first letter
                if (words.length === 1) {
                    return words[0].charAt(0).toUpperCase();
                }

                // If there are multiple words, use the first letters of the first two words
                return words[0].charAt(0).toUpperCase() + words[1].charAt(0).toUpperCase();
            }
            friends.forEach(friend => {
                // Create div element for each group

                var link = document.createElement("a");
                link.setAttribute("class", "frnd-lst-item");
                link.setAttribute("href", "#");
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    console.log(friend);
                    openFriendView(friend);
                });

                var logoDiv = document.createElement("div");
                logoDiv.setAttribute("class", "frnd-logo");
                logoDiv.textContent = generateLogoText(friend);
                logoDiv.style.backgroundColor = getRandomColor();

                // Create <div> for friend name
                var nameDiv = document.createElement("div");
                nameDiv.setAttribute("class", "frnd-name");

                // Create <span> for friend's name
                var nameSpan = document.createElement("span");
                nameSpan.setAttribute("class", "grp-name");
                nameSpan.textContent = friend;

                // Append <span> to the <div> for friend name
                nameDiv.appendChild(nameSpan);

                // Append friend logo and name to the <a> element
                link.appendChild(logoDiv);
                link.appendChild(nameDiv);

                // Append the <a> element to the container
                container.appendChild(link);
            });
            console.log("Function Called and Execution Completed");
        }
        async function getFriendDetails(friend) {
            try {
                const formData = new FormData();
                console.log(friend)
                formData.append('friend', friend);
                console.log(formData + "Todaty is tuesday.");

                const response = await fetch('/get-friend-details', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user groups');
                }

                const friendData = await response.json();
                return friendData;
            } catch (error) {
                console.error('Error fetching user groups:', error);
                return null;
            }
        }
        async function openFriendView(friendData) {
            console.log(friendData+"This is friend Data");
            const friend = await getFriendDetails(friendData);
            console.log(friend);
            const friendContainer = document.querySelector(".selected-friend-info")
            const emptySate = document.querySelector('#empty-state-friend');
            friendContainer.style.display = 'flex';
            emptySate.style.display = "none";
            const friendName = friendContainer.querySelector("#frnd-name");
            const friendBio = friendContainer.querySelector('#frnd-common');
            const friendEmail = friendContainer.querySelector('#frnd-email');
            const friendStreaks = friendContainer.querySelector('#report-streak');
            const friendGems = friendContainer.querySelector('#report-gems');
            const friendHearts = friendContainer.querySelector('#report-heart');
            const friendLeaderboard = friendContainer.querySelector('#report-leaderboard');
            const longestStreak = friendContainer.querySelector('#longest-streak');
            const longestStreakDesc = friendContainer.querySelector('#longest-streak-desc');

            const rmvBtn = friendContainer.querySelector('#frnd-rmv');

            const stkBtn = friendContainer.querySelector('#frnd-stk');

            rmvBtn.addEventListener('click', async () => {
                try {
                    if (await createConfirmBox(`Confirm Remove ${friend.friend.username} as Friend?`, "When you unfriend someone, they'll get a notification saying you've removed them.")) {
                        await removeFriend(friend.friend.username);
                        await generateUserFriendsList("");
                        friendContainer.style.display = "none";
                        emptySate.style.display = "flex";
                    }

                } catch (error) {
                    console.error('Error removing friend:', error);
                }
            });

            stkBtn.addEventListener('click', async () => {
                try {
                    const friendUsername = stkBtn.dataset.username; // Assuming you store the friend's username in a data attribute
                    await someAsyncFunction(friendUsername); // Replace someAsyncFunction with the function you want to call
                } catch (error) {
                    console.error('Error:', error);
                }
            });

            const comFrnd = friend.common_friends;
            const comGrps = friend.common_groups;

            friendName.textContent = friend.friend.username;
            // console.log(`You and ${friend.friend.username} have ${comFrnd} friend and ${comGrps} groups in common.`);
            friendBio.textContent = `${friend.friend.username} and you share ${comFrnd} friend and ${comGrps} groups.`;
            friendEmail.textContent = friend.friend.email;
            friendStreaks.textContent = friend.friend.stats[0].streaks;
            friendGems.textContent = friend.friend.stats[0].streaks;
            friendHearts.textContent = friend.friend.stats[0].streaks;
            friendLeaderboard.textContent = friend.friend.stats[0].streaks;
            // longestStreak.textContent = friend.friend.daily_tasks_data[0].longestStreak;
            longestStreak.textContent = 32;
            longestStreakDesc.textContent = `Longest Streak between you and ${friend.friend.username}`

        }
    </script>
</body>

</html>
<!-- 

<div class="alert-box" id="alert-friend-form">Oh O! Invalid Username</div> -->