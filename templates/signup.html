<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnSync Signup</title>
    <link rel="stylesheet" href="../static/css/style-updated.css">
    <link rel="stylesheet" href="../static/css/style-login.css">
</head>

<body>
    <login-overlay id="login-overlay">
        <!-- <button id="close-login" class="link-tertiary">Close</button> -->
        <form action="/sign-up" id="signup-form" method="post">
            <div class="login-container">
                <div class="heading">Signup</div>
                <div id="step1" class="form-step">
                    <input type="text" name="username" id="username" placeholder="Username" required>
                    <input type="password" name="password" id="password" placeholder="Password" required>
                    <input type="password" name="not-pass" id="not-pass" placeholder="Re-confirm Password" required>
                    <a href="#" class="link-primary" id="signup-link">Signup</a>

                    <span>or continue with</span>

                    <a href="#" class="link-primary">Google</a>
                </div>
                <div id="step2" class="form-step">
                    <select name="not-select" id=""></select>
                </div>
                <div class="nav-form">
                    <a id="prev-button" class="link-primary">
                        <span class="material-symbols-outlined">
                            arrow_back
                        </span>&nbsp;
                        Previous
                    </a>
                    <a id="next-button" class="link-primary">Next &nbsp;
                        <span class="material-symbols-outlined">
                            arrow_forward
                        </span>
                    </a>
                </div>
            </div>
        </form>
    </login-overlay>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const formSteps = document.querySelectorAll('.form-step');
            let currentStep = 0;
            updateNavButtons();

            document.querySelector('#prev-button').addEventListener('click', function (e) {
                e.preventDefault();
                currentStep = Math.max(0, currentStep - 1);
                updateNavButtons();
            });

            document.querySelector('#next-button').addEventListener('click', function (e) {
                e.preventDefault();
                currentStep = Math.min(formSteps.length - 1, currentStep + 1);
                updateNavButtons();
            });

            // document.querySelector('#signup-link').addEventListener('click', function (e) {
            //     e.preventDefault();
            //     document.getElementById('signup-form').submit(); // Submit the form
            // });

            function updateNavButtons() {
                formSteps.forEach((step, index) => {
                    step.style.display = index === currentStep ? 'flex' : 'none';
                });

                document.querySelector('#prev-button').disabled = currentStep === 0;
                document.querySelector('#next-button').disabled = currentStep === formSteps.length - 1;
            }

        });
    </script>

    <!-- For Username Verification -->
    <script>
        async function checkUsername(username) {
            const response = await fetch('/check-username-availability', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `username=${username}`
            });
            const data = await response.json();
            return data.message === 'Username available';
        }

        document.querySelector('#signup-link').addEventListener('click', async function (e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const not_pass = document.getElementById('not-pass').value;
            const isUsernameAvailable = await checkUsername(username);
            
            if (isUsernameAvailable && password === not_pass) { console.log('Username is available and passwords match. Submitting form...');}

            if (isUsernameAvailable && password === not_pass) {
                document.getElementById('signup-form').submit();
            } else if (!isUsernameAvailable) {
                alert('Username already exists. Please choose a different username.');
            } else if (password !== not_pass) {
                alert('Passwords do not match. Please re-enter your passwords.');
            }
        });
    </script>
</body>

</html>